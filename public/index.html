<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZP GPF Management System - SPSR NELLORE District</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #4a7ca7;
            --secondary-color: #6c9bd2;
            --accent-color: #b0cff3;
            --light-bg: #f5f8fc;
            --dark-text: #494949;
            --border-color: #ddd;
            --success-color: #5cb85c;
            --danger-color: #d9534f;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: var(--dark-text);
        }
        
        /* Navigation Styles */
        .navbar {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0.5rem 1rem;
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: white !important;
        }
        
        .navbar-brand img {
            height: 45px;
            margin-right: 10px;
            border-radius: 15%;
        }
        
        .navbar-nav .nav-link {
            color: rgba(255,255,255,0.8) !important;
            margin: 0 5px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .navbar-nav .nav-link:hover, .navbar-nav .nav-link.active {
            background-color: rgba(255,255,255,0.2);
            color: white !important;
        }
        
        .dropdown-menu {
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .size{
            font-size: 10px;
        }

        .s2{
            font-size: 6px;
        }
        
        .s3{
            font-size: 4;
        }

        .h1{
            height: 90px;
        }

        .h2{
            height: 165px;
        }
        
        .small{
            font-size: 2px;
            
        }
        .custome{
            
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }

        

        /* Dashboard Styles */
        .dashboard-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            background: linear-gradient(to right, var(--accent-color), white);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .dashboard-header h1 {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .dashboard-header p {
            color: var(--dark-text);
            margin-bottom: 0;
        }
        
        .stats-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-card .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: white;
            font-size: 24px;
        }
        
        .stats-card.primary .card-icon {
            background-color: var(--primary-color);
        }
        
        .stats-card.success .card-icon {
            background-color: var(--success-color);
        }
        
        .stats-card.info .card-icon {
            background-color: #17a2b8;
        }
        
        .stats-card.warning .card-icon {
            background-color: #ffc107;
        }
        
        .stats-card h3 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stats-card p {
            color: #6c757d;
            margin-bottom: 0;
        }
        
        .recent-activity {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-content h5 {
            margin-bottom: 0;
            font-size: 14px;
        }
        
        .activity-content p {
            margin-bottom: 0;
            font-size: 12px;
            color: #6c757d;
        }
        
        .main-container {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .header-section {
            background: linear-gradient(to bottom, var(--accent-color), var(--accent-color));
            color: var(--dark-text);
            text-align: center;
            padding: 15px;
            border-bottom: 1px solid #5d5c5c;
            position: relative;
        }
        
        .header-section .logo {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .header-section h1 {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .header-section h2 {
            font-size: 12px;
            font-weight: normal;
        }
        
        .employee-details {
            background-color: var(--light-bg);
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .detail-row {
            display: flex;
            font-size: 10px;
        }
        
        .detail-label {
            font-weight: bold;
            width: 180px;
        }
        
        .detail-value {
            flex: 1;
        }
        
        .table-section {
            padding: 20px;
        }
        
        .section-title {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 8px;
        }
        
        .gpf-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .gpf-table th {
            background-color: var(--light-bg);
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .gpf-table td {
            border: 1px solid var(--border-color);
            padding: 6px 8px;
            text-align: right;
        }
        
        .gpf-table td:first-child {
            text-align: left;
        }
        
        .gpf-table input {
            width: 100%;
            border: none;
            background: transparent;
            text-align: right;
            padding: 4px;
            font-size: 12px;
            font-weight: normal;
            -moz-appearance: textfield;
            -webkit-appearance: textfield;
            appearance: textfield;
        }
        
        .gpf-table input::-webkit-outer-spin-button,
        .gpf-table input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .gpf-table input[type=number] {
            -moz-appearance: textfield;
        }
        
        .gpf-table input:focus {
            background: #ffffcc;
            outline: 1px solid var(--secondary-color);
            font-weight: bold;
        }
        
        .gpf-table .month-cell {
            text-align: left;
            font-weight: bold;
        }
        
        .total-row {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .total-row td {
            border-top: 1px solid var(--border-color);
        }
        
        .action-buttons {
            padding: 15px;
            text-align: center;
            border-top: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        
        .btn-custom {
            padding: 8px 15px;
            margin: 0 5px;
            border: 1px solid var(--secondary-color);
            background: white;
            color: var(--secondary-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
        }
        
        .btn-custom i {
            margin-right: 5px;
        }
        
        .btn-custom:hover {
            background: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-primary-custom {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-primary-custom:hover {
            background: var(--primary-color);
        }
        
        .btn-success-custom {
            border-color: var(--success-color);
            color: var(--success-color);
        }
        
        .btn-success-custom:hover {
            background: var(--success-color);
            color: white;
        }
        
        .btn-danger-custom {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }
        
        .btn-danger-custom:hover {
            background: var(--danger-color);
            color: white;
        }
        
        .no-print {
            display: block;
        }
        
        .edit-mode {
            background-color: #fffacd !important;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--success-color);
            color: white;
            border-radius: 4px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 14px;
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #adb5bd;
        }
        
        .modal-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .modal-header .btn-close {
            color: white;
            opacity: 0.8;
        }
        
        .form-label {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 13px;
        }
        
        .form-control {
            font-size: 13px;
            padding: 8px;
        }
        
        .employee-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .employee-item {
            padding: 10px;
            border: 1px solid var(--border-color);
            margin-bottom: 5px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            border-radius: 4px;
        }
        
        .employee-item:hover {
            background-color: var(--light-bg);
        }
        
        .employee-item.active {
            background-color: var(--light-bg);
            border-color: var(--secondary-color);
        }
        
        .employee-info {
            flex: 1;
        }
        
        .employee-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-icon {
            padding: 5px 8px;
            font-size: 11px;
            border-radius: 3px;
            border: 1px solid var(--border-color);
            background: white;
            color: #6c757d;
            cursor: pointer;
        }
        
        .btn-icon:hover {
            background: #f0f0f0;
        }
        
        .btn-icon.delete {
            color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-icon.delete:hover {
            background: var(--danger-color);
            color: white;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
            font-size: 8px;
        }
        
        .summary-table th {
            background-color: var(--light-bg);
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
            font-weight: bold;
        }
        
        .summary-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: right;
        }
        
        .summary-table td:first-child {
            text-align: left;
            font-weight: bold;
        }
        
        .summary-table .highlight-row {
            background-color: var(--light-bg);
            font-weight: bold;
        }
        
        .chart-container {
            height: 170px;
            margin-bottom: 20px;
        }
        
        .hero-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .welcome-section {
            background: linear-gradient(to right, rgba(74, 124, 167, 0.9), rgba(108, 155, 210, 0.9)), url('https://images.unsplash.com/photo-1554224154-260325c0598e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .welcome-section h1 {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .welcome-section p {
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 20px;
        }
        
        .feature-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-card i {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .feature-card p {
            color: #6c757d;
            margin-bottom: 0;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Report Table Styles */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        .report-table th {
            background-color: var(--primary-color);
            color: white;
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
            font-weight: bold;
        }
        
        .report-table td {
            border: 1px solid var(--border-color);
            padding: 6px 8px;
        }
        
        .report-table td:nth-child(n+3) {
            text-align: right;
        }
        
        .report-table .total-row {
            background-color: var(--light-bg);
            font-weight: bold;
        }
        
        .report-table .total-row td {
            border-top: 2px solid var(--primary-color);
        }
        
        .report-filters {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 10px;
            margin-bottom: 20px;
        }
        
        .report-actions {
            text-align: right;
            margin-bottom: 15px;
        }
        
        .month-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .month-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--dark-text);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .month-btn:hover {
            background: var(--light-bg);
        }
        
        .month-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 2px solid #4a7ca7;
        }
        
        .print-header h1 {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #4a7ca7;
        }
        
        .print-header h2 {
            font-size: 10px;
            margin-bottom: 0;
            color: #6c9bd2;
        }
        
        .size2 {
            font-size: 12px;
        }
        
        .size3 {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark no-print">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://ik.imagekit.io/htkonwcyl/pics/Nlr-zp.jpeg?updatedAt=1765869301452" alt="GPF Logo">
                &nbsp;&nbsp;ZP GPF NELLORE
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showPage('dashboard')">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('employees')">
                            <i class="bi bi-people"></i> Employees
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="reportsDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-file-earmark-text"></i> Reports
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="showPage('monthly-report')">
                                <i class="bi bi-calendar-month"></i> Monthly Report
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showPage('annual-report')">
                                <i class="bi bi-calendar-year"></i> Annual Report
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showPage('employee-summary')">
                                <i class="bi bi-person-lines-fill"></i> Employee Summary
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('settings')">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('help')">
                            <i class="bi bi-question-circle"></i> Help
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page-content active">
        <div class="dashboard-container">
            <div class="welcome-section">
                <h1>WELCOME TO ZILLA PRAJA PARISHAD S.P.S.R NELLORE</h1>
                <p>Manage employee provident fund records efficiently and generate comprehensive reports with ease.</p>
                <button class="btn btn-light btn-lg" onclick="showPage('employees')">
                    <i class="bi bi-person-plus"></i> Add New Employee
                </button>
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="stats-card primary">
                        <div class="card-icon">
                            <i class="bi bi-people-fill"></i>
                        </div>
                        <h3 id="totalEmployees">0</h3>
                        <p>Total Employees</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card success">
                        <div class="card-icon">
                            <i class="bi bi-currency-rupee"></i>
                        </div>
                        <h3 id="totalBalance">â‚¹0</h3>
                        <p>Total GPF Balance</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card info">
                        <div class="card-icon">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <h3 id="currentYear">2023-24</h3>
                        <p>Current Financial Year</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card warning">
                        <div class="card-icon">
                            <i class="bi bi-graph-up"></i>
                        </div>
                        <h3 id="growthRate">7.1%</h3>
                        <p>Interest Rate</p>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="recent-activity">
                        <h4 class="mb-3">Recent Activities</h4>
                        <div id="recentActivities">
                            <div class="activity-item">
                                <div class="activity-icon" style="background-color: var(--success-color);">
                                    <i class="bi bi-person-plus"></i>
                                </div>
                                <div class="activity-content">
                                    <h5>New Employee Added</h5>
                                    
                                </div>
                                <div class="activity-time">2 hours ago</div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="background-color: var(--primary-color);">
                                    <i class="bi bi-pencil-square"></i>
                                </div>
                                <div class="activity-content">
                                    <h5>Record Updated</h5>
                                    
                                </div>
                                <div class="activity-time">5 hours ago</div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="background-color: var(--danger-color);">
                                    <i class="bi bi-file-earmark-excel"></i>
                                </div>
                                <div class="activity-content">
                                    <h5>Report Generated</h5>
                                    
                                </div>
                                <div class="activity-time">Yesterday</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="recent-activity">
                        <h4 class="mb-3">Quick Actions</h4>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="showPage('employees')">
                                <i class="bi bi-person-plus"></i> Add New Employee
                            </button>
                            <button class="btn btn-outline-success" onclick="exportAllEmployeesToExcel()">
                                <i class="bi bi-file-earmark-excel"></i> Export All Data
                            </button>
                            <button class="btn btn-outline-info" onclick="showPage('monthly-report')">
                                <i class="bi bi-file-earmark-text"></i> Generate Report
                            </button>
                            <button class="btn btn-outline-warning" onclick="showPage('settings')">
                                <i class="bi bi-gear"></i> System Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Employees Page -->
    <div id="employees-page" class="page-content">
        <div class="notification" id="notification"></div>
        
        <div class="main-container">
            <!-- Header Section -->
            <div class="header-section no-print">
                <img src="https://ik.imagekit.io/htkonwcyl/pics/Emblem_of_Andhra_Pradesh_before_2014.svg.png?updatedAt=1765727491775" alt="GPF Logo" class="logo">
                <h1>ZP PROVIDENT FUND</h1>
                <h2>ANDHRA PRADESH, SPSR NELLORE DISTRICT</h2>
            </div>
            
            <!-- Employee Selection (shown when no employee is selected) -->
            <div id="employeeSelection" class="employee-details">
                <div class="text-center mb-3">
                    <button class="btn-custom btn-primary-custom" onclick="showNewEmployeeModal()">
                        <i class="bi bi-person-plus"></i> ADD NEW EMPLOYEE
                    </button>
                    <button class="btn-custom" onclick="showEmployeeList()">
                        <i class="bi bi-list-ul"></i> VIEW ALL EMPLOYEES
                    </button>
                    <button class="btn-custom btn-success-custom" onclick="exportAllEmployeesToExcel()">
                        <i class="bi bi-file-earmark-excel"></i> EXPORT ALL TO EXCEL
                    </button>
                    <button class="btn-custom btn-primary-custom" onclick="showSearchEmployeeModal()">
                        <i class="bi bi-search"></i> SEARCH EMPLOYEE
                    </button>
                </div>
            </div>
            
            <!-- Employee Details (shown when employee is selected) -->
            <div id="employeeDetails" class="employee-details" style="display: none;">
                <div class="detail-row">
                    <span class="detail-label">GPF Account No:</span>
                    <span class="detail-value" id="gpfAccountNo">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Employee Name:</span>
                    <span class="detail-value" id="employeeName">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Designation:</span>
                    <span class="detail-value" id="designation">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Place Of Work:</span>
                    <span class="detail-value" id="placeOfWork">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Mandal:</span>
                    <span class="detail-value" id="mandal">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Financial Year:</span>
                    <span class="detail-value" id="financialYear">-</span>
                </div>
            </div>
            
            <!-- GPF Transactions Table -->
            <div id="tableSection" class="table-section" style="display: none;">
                <div class="section-title">
                    <i class="bi bi-table"></i> Monthly GPF Transactions
                </div>
                <table class="gpf-table" id="gpfTable">
                    <thead>
                        <tr>
                            <th style="width: 15%">MONTH</th>
                            <th style="width: 16%">OB</th>
                            <th style="width: 16%">SUBSCRIPTION</th>
                            <th style="width: 16%">DA + PF RECOVERY</th>
                            <th style="width: 16%">WITHDRAWAL</th>
                            <th style="width: 21%">CB</th>
                        </tr>
                    </thead>
                    <tbody id="gpfTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
                
                <div id="emptyState" class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <p>No data available. Click "UPDATE RECORD" to add monthly transactions.</p>
                </div>
                
                <!-- Summary Table -->
                <div id="summarySection" style="display: none;">
                    <div class="section-title">
                        <i class="bi bi-calculator"></i> Annual Summary
                    </div>
                    <table class="summary-table" id="summaryTable">
                        <thead>
                            <tr>
                                <th style="width: 30% "  >DESCRIPTION</th>
                                <th style="width: 30%">AMOUNT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Opening Balance</td>
                                <td id="totalOB">0</td>
                            </tr>
                            <tr>
                                <td>Total Subscription</td>
                                <td id="totalSubscription">0</td>
                            </tr>
                            <tr>
                                <td>Total DA + PF Recovery</td>
                                <td id="totalDA">0</td>
                            </tr>
                            <tr>
                                <td>Total Withdrawal</td>
                                <td id="totalLoan">0</td>
                            </tr>
                            <tr>
                                <td>Cumulative </td>
                                <td id="cumulative">0</td>
                            </tr>
                            <tr>
                                <td>Interest </td>
                                <td id="interest">0</td>
                            </tr>
                            <tr>
                                <td>Gross </td>
                                <td id="gross">0</td>
                            </tr>
                            <tr class="highlight-row">
                                <td>Closing Balance </td>
                                <td id="closingBalance">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div id="actionButtons" class="action-buttons no-print" style="display: none;">
                <button class="btn-custom" onclick="showNewEmployeeModal()">
                    <i class="bi bi-person-plus"></i> NEW EMPLOYEE
                </button>
                <button class="btn-custom btn-primary-custom" onclick="updateRecord()">
                    <i class="bi bi-pencil-square"></i> UPDATE RECORD
                </button>
                <button class="btn-custom btn-success-custom" onclick="saveRecord()">
                    <i class="bi bi-save"></i> SAVE RECORD
                </button>
                <button class="btn-custom no-print-when-edit" onclick="printRecord()">
                    <i class="bi bi-printer"></i> PRINT
                </button>
                <button class="btn-custom btn-danger-custom" onclick="deleteCurrentEmployee()">
                    <i class="bi bi-trash"></i> DELETE RECORD
                </button>
                <button class="btn-custom" onclick="clearCurrentEmployee()">
                    <i class="bi bi-arrow-left"></i> BACK
                </button>
                <button class="btn-custom" onclick="exitApplication()">
                    <i class="bi bi-box-arrow-right"></i> EXIT
                </button>
            </div>
        </div>
    </div>

    <!-- Monthly Report Page -->
    <div id="monthly-report-page" class="page-content">
        <div class="dashboard-container">
            <div class="report-filters">
                <h3>Monthly GPF Report</h3>
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Financial Year</label>
                        <select class="form-select" id="reportFinancialYear">
                            <option value="2021-2022">2021-2022</option>
                            <option value="2022-2023">2022-2023</option>
                            <option value="2023-2024" selected>2023-2024</option>
                            <option value="2024-2025">2024-2025</option>
                            <option value="2025-2026">2025-2026</option>
                            <option value="2026-2027">2026-2027</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Mandal</label>
                        <select class="form-select" id="monthlyReportMandal">
                            <option value="all">All Mandals</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Select Month</label>
                        <div class="month-selector">
                            <button class="month-btn" data-month="April">April</button>
                            <button class="month-btn" data-month="May">May</button>
                            <button class="month-btn" data-month="June">June</button>
                            <button class="month-btn" data-month="July">July</button>
                            <button class="month-btn" data-month="August">August</button>
                            <button class="month-btn" data-month="September">September</button>
                            <button class="month-btn" data-month="October">October</button>
                            <button class="month-btn" data-month="November">November</button>
                            <button class="month-btn" data-month="December">December</button>
                            <button class="month-btn" data-month="January">January</button>
                            <button class="month-btn" data-month="February">February</button>
                            <button class="month-btn" data-month="March">March</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="report-actions">
                <button class="btn btn-primary" onclick="generateMonthlyReport()">
                    <i class="bi bi-file-earmark-text"></i> Generate Report
                </button>
                <button class="btn btn-success" onclick="exportMonthlyReportToExcel()">
                    <i class="bi bi-file-earmark-excel"></i> Export to Excel
                </button>
                <button class="btn btn-info" onclick="printMonthlyReport()">
                    <i class="bi bi-printer"></i> Print
                </button>
            </div>
            
            <div id="monthlyReportContent">
                <div class="empty-state">
                    <i class="bi bi-calendar-x"></i>
                    <p>Select a month and click "Generate Report" to view monthly GPF transactions</p>
                </div>
            </div>
            
            <div class="print-footer">
                <p>Generated on: <span id="monthlyReportDate"></span></p>
            </div>
        </div>
    </div>

    <!-- Annual Report Page -->
    <div id="annual-report-page" class="page-content">
        <div class="dashboard-container">
            <div class="report-filters">
                <h3>Annual GPF Report</h3>
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Financial Year</label>
                        <select class="form-select" id="annualReportFinancialYear">
                            <option value="2021-2022">2021-2022</option>
                            <option value="2022-2023">2022-2023</option>
                            <option value="2023-2024" selected>2023-2024</option>
                            <option value="2024-2025">2024-2025</option>
                            <option value="2025-2026">2025-2026</option>
                            <option value="2026-2027">2026-2027</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Mandal</label>
                        <select class="form-select" id="annualReportMandal">
                            <option value="all">All Mandals</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Report Type</label>
                        <select class="form-select" id="reportType">
                            <option value="summary">Summary Report</option>
                            <option value="detailed">Detailed Report</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="report-actions">
                <button class="btn btn-primary" onclick="generateAnnualReport()">
                    <i class="bi bi-file-earmark-text"></i> Generate Report
                </button>
                <button class="btn btn-success" onclick="exportAnnualReportToExcel()">
                    <i class="bi bi-file-earmark-excel"></i> Export to Excel
                </button>
                <button class="btn btn-info" onclick="printAnnualReport()">
                    <i class="bi bi-printer"></i> Print
                </button>
            </div>
            
            <div id="annualReportContent">
                <div class="empty-state">
                    <i class="bi bi-calendar-x"></i>
                    <p>Select options and click "Generate Report" to view annual GPF summary</p>
                </div>
            </div>
            
            <div class="print-footer">
                <p>Generated on: <span id="annualReportDate"></span></p>
            </div>
        </div>
    </div>

    <!-- Employee Summary Page -->
    <div id="employee-summary-page" class="page-content">
        <div class="dashboard-container">
            <div class="report-filters">
                <h3>Employee Summary Report</h3>
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Financial Year</label>
                        <select class="form-select" id="summaryFinancialYear">
                            <option value="2021-2022">2021-2022</option>
                            <option value="2022-2023">2022-2023</option>
                            <option value="2023-2024" selected>2023-2024</option>
                            <option value="2024-2025">2024-2025</option>
                            <option value="2025-2026">2025-2026</option>
                            <option value="2026-2027">2026-2027</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Mandal</label>
                        <select class="form-select" id="summaryMandal">
                            <option value="all">All Mandals</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Employee</label>
                        <select class="form-select" id="summaryEmployeeSelect">
                            <option value="all">All Employees</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="report-actions">
                <button class="btn btn-primary" onclick="generateEmployeeSummary()">
                    <i class="bi bi-file-earmark-text"></i> Generate Report
                </button>
                <button class="btn btn-success" onclick="exportEmployeeSummaryToExcel()">
                    <i class="bi bi-file-earmark-excel"></i> Export to Excel
                </button>
                <button class="btn btn-info" onclick="printEmployeeSummary()">
                    <i class="bi bi-printer"></i> Print
                </button>
            </div>
            
            <div id="employeeSummaryContent">
                <div class="empty-state">
                    <i class="bi bi-person-x"></i>
                    <p>Select options and click "Generate Report" to view employee summary</p>
                </div>
            </div>
            
            <div class="print-footer">
                <p>Generated on: <span id="employeeSummaryDate"></span></p>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settings-page" class="page-content">
        <div class="dashboard-container">
            <h2 class="mb-4">System Settings</h2>
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">General Settings</h5>
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label class="form-label">Organization Name</label>
                                    <input type="text" class="form-control" value="SPSR NELLORE DISTRICT">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Current Financial Year</label>
                                    <select class="form-select">
                                        <option value="2021-2022">2021-2022</option>
                                        <option value="2022-2023">2022-2023</option>
                                        <option value="2023-2024">2023-2024</option>
                                        <option value="2024-2025">2024-2025</option>
                                        <option value="2025-2026">2025-2026</option>
                                        <option value="2026-2027">2026-2027</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Interest Rate (%)</label>
                                    <input type="number" class="form-control" value="7.1" step="0.1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Delete Single Record</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="deleteGpfAccountNo" placeholder="Enter GPF Account No">
                                        <button class="btn btn-danger" type="button" onclick="deleteSingleEmployee()">
                                            <i class="bi bi-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Delete All Records</label>
                                    <button type="button" class="btn btn-danger" onclick="deleteAllRecords()">
                                        <i class="bi bi-trash"></i> Delete All Records
                                    </button>
                                </div>
                                <button type="button" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Backup & Restore</h5>
                        </div>
                        <div class="card-body">
                            <p class="mb-3">Create backups of your GPF data to prevent data loss.</p>
                            <div class="d-grid gap-2">
                                <button class="btn btn-success">
                                    <i class="bi bi-cloud-download"></i> Create Backup
                                </button>
                                <button class="btn btn-outline-success">
                                    <i class="bi bi-cloud-upload"></i> Restore from Backup
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">System Information</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <tr>
                                    <td>Version</td>
                                    <td>1.0.0</td>
                                </tr>
                                <tr>
                                    <td>Last Updated</td>
                                    <td>June 15, 2023</td>
                                </tr>
                                <tr>
                                    <td>Database Size</td>
                                    <td>2.4 MB</td>
                                </tr>
                                <tr>
                                    <td>Total Records</td>
                                    <td id="totalEmployeesSettings">0</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Page -->
    <div id="help-page" class="page-content">
        <div class="dashboard-container">
            <div class="print-header">
                <h1>ZILLA PARISHAD GENERAL PROVIDENT FUND</h1>
                <h2>ANDHRA PRADESH, SPSR NELLORE DISTRICT</h2>
            </div>
            
            <h2 class="mb-4">Help & Support</h2>
            <div class="accordion" id="helpAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                            Getting Started
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                        <div class="accordion-body">
                            <p>Welcome to ZP PROVIDENT FUND Management System! Here's how to get started:</p>
                            <ol>
                                <li>Add new employees by clicking "ADD NEW EMPLOYEE" button</li>
                                <li>Enter monthly transactions for each employee</li>
                                <li>Generate reports for analysis and record-keeping</li>
                                <li>Export data to Excel for further processing</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                            Adding Employees
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                        <div class="accordion-body">
                            <p>To add a new employee to system:</p>
                            <ol>
                                <li>Click on "ADD NEW EMPLOYEE" button</li>
                                <li>Fill in the required employee details</li>
                                <li>Set the opening balance for the employee's GPF account</li>
                                <li>Click "Save Employee" to add the employee to the system</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                            Managing Transactions
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                        <div class="accordion-body">
                            <p>To manage monthly GPF transactions:</p>
                            <ol>
                                <li>Select an employee from the employee list</li>
                                <li>Click on "UPDATE RECORD" to enter edit mode</li>
                                <li>Enter the monthly subscription, recovery, and withdrawal amounts</li>
                                <li>The system will automatically calculate the closing balance</li>
                                <li>Click "SAVE RECORD" to save your changes</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                            Generating Reports
                        </button>
                    </h2>
                    <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                        <div class="accordion-body">
                            <p>The system offers several types of reports:</p>
                            <ul>
                                <li><strong>Monthly Report:</strong> View transactions for a specific month</li>
                                <li><strong>Annual Report:</strong> Get a comprehensive yearly summary</li>
                                <li><strong>Employee Summary:</strong> View individual employee details</li>
                                <li><strong>Export to Excel:</strong> Download data for further analysis</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Contact Support</h5>
                </div>
                <div class="card-body">
                    <p>If you need further assistance, please contact our support team:</p>
                    <ul>
                        <li>Email: zppnlrhsec@gmail.com</li>
                        <li>Phone: 8985004706</li>
                        <li>Office Hours: Monday to Friday, 11:00 AM to 5:00 PM</li>
                    </ul>
                </div>
            </div>
            
            <div class="print-footer">
                <p>Generated on: <span id="helpPageDate"></span></p>
            </div>
        </div>
    </div>

    <!-- New Employee Modal -->
    <div class="modal fade" id="newEmployeeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Employee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newEmployeeForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">GPF Account No</label>
                                <input type="text" class="form-control" id="newGpfAccountNo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Employee Name</label>
                                <input type="text" class="form-control" id="newEmployeeName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Designation</label>
                                <input type="text" class="form-control" id="newDesignation" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Place Of Work</label>
                                <input type="text" class="form-control" id="newPlaceOfWork" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Mandal</label>
                                <input type="text" class="form-control" id="newMandal" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Financial Year</label>
                                <select class="form-select" id="newFinancialYear" required>
                                        <option value="2021-2022">2021-2022</option>
                                        <option value="2022-2023">2022-2023</option>
                                        <option value="2023-2024">2023-2024</option>
                                        <option value="2024-2025">2024-2025</option>
                                        <option value="2025-2026">2025-2026</option>
                                        <option value="2026-2027">2026-2027</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Opening Balance</label>
                                <input type="number" class="form-control" id="newOpeningBalance" value="0" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveNewEmployee()">Save Employee</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee List Modal -->
    <div class="modal fade" id="employeeListModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">All Employees</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="employee-list" id="employeeList">
                        <!-- Employee list will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Employee Modal -->
    <div class="modal fade" id="searchEmployeeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Search Employee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Enter GPF Account No</label>
                        <input type="text" class="form-control" id="searchGpfAccountNo" placeholder="Enter GPF Account No">
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary" onclick="searchEmployeeByGpf()">Search</button>
                    </div>
                    <div id="searchResult" class="mt-3">
                        <!-- Search result will be displayed here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
   
    <script>
        // Data storage
        let employees = JSON.parse(localStorage.getItem('gpfEmployees')) || [];
        let currentEmployee = null;
        let isEditMode = false;
        let calculationTimeout = null;
        let searchedEmployee = null;
        let selectedMonth = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboardStats();
            populateEmployeeSelects();
            populateMandalSelects();
            setupMonthSelector();
            
            // Set current date in footer
            const currentDate = new Date().toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update all date spans
            const dateElements = ['monthlyReportDate', 'annualReportDate', 'employeeSummaryDate', 'helpPageDate'];
            dateElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = currentDate;
            });
            
            if (employees.length === 0) {
                document.getElementById('employeeSelection').style.display = 'block';
                document.getElementById('employeeDetails').style.display = 'none';
                document.getElementById('tableSection').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
            }
        });
        
        // Update dashboard statistics
        function updateDashboardStats() {
            // Calculate total employees
            document.getElementById('totalEmployees').textContent = employees.length;
            document.getElementById('totalEmployeesSettings').textContent = employees.length;
            
            // Calculate total balance
            let totalBalance = 0;
            employees.forEach(emp => {
                if (emp.transactions.length > 0) {
                    const lastTransaction = emp.transactions[emp.transactions.length - 1];
                    totalBalance += lastTransaction.cb;
                } else {
                    totalBalance += emp.openingBalance;
                }
            });
            
            document.getElementById('totalBalance').textContent = 'â‚¹' + totalBalance.toLocaleString('en-IN');
            
            // Set current financial year
            const currentMonth = new Date().getMonth();
            let currentYear = new Date().getFullYear();
            let financialYear = '';
            
            if (currentMonth >= 3) { // April onwards
                financialYear = `${currentYear}-${currentYear + 1}`;
            } else {
                financialYear = `${currentYear - 1}-${currentYear}`;
            }
            
            document.getElementById('currentYear').textContent = financialYear;
        }
        
        // Populate employee selects in reports
        function populateEmployeeSelects() {
            const summarySelect = document.getElementById('summaryEmployeeSelect');
            summarySelect.innerHTML = '<option value="all">All Employees</option>';
            
            employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.gpfAccountNo} - ${emp.name}`;
                summarySelect.appendChild(option);
            });
        }
        
        // Populate Mandal selects in reports
        function populateMandalSelects() {
            const mandals = [...new Set(employees.map(emp => emp.mandal).filter(Boolean))];
            
            const monthlySelect = document.getElementById('monthlyReportMandal');
            const annualSelect = document.getElementById('annualReportMandal');
            const summarySelect = document.getElementById('summaryMandal');
            
            // Clear existing options (except "All Mandals")
            while (monthlySelect.options.length > 1) monthlySelect.remove(1);
            while (annualSelect.options.length > 1) annualSelect.remove(1);
            while (summarySelect.options.length > 1) summarySelect.remove(1);
            
            // Add Mandal options
            mandals.forEach(mandal => {
                monthlySelect.add(new Option(mandal, mandal));
                annualSelect.add(new Option(mandal, mandal));
                summarySelect.add(new Option(mandal, mandal));
            });
        }
        
        // Setup month selector
        function setupMonthSelector() {
            const monthButtons = document.querySelectorAll('.month-btn');
            monthButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    monthButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedMonth = this.dataset.month;
                });
            });
        }
        
        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(`${pageId}-page`).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Set active nav link
            if (pageId === 'dashboard') {
                document.querySelector('.nav-link[href="#"][onclick*="dashboard"]').classList.add('active');
            } else if (pageId === 'employees') {
                document.querySelector('.nav-link[href="#"][onclick*="employees"]').classList.add('active');
            } else if (pageId.includes('report')) {
                document.querySelector('#reportsDropdown').classList.add('active');
            } else if (pageId === 'settings') {
                document.querySelector('.nav-link[href="#"][onclick*="settings"]').classList.add('active');
            } else if (pageId === 'help') {
                document.querySelector('.nav-link[href="#"][onclick*="help"]').classList.add('active');
            }
            
            // Update dashboard stats when returning to dashboard
            if (pageId === 'dashboard') {
                updateDashboardStats();
            }
        }
        
        // Generate Monthly Report
        function generateMonthlyReport() {
            const financialYear = document.getElementById('reportFinancialYear').value;
            const mandalFilter = document.getElementById('monthlyReportMandal').value;
            
            if (!selectedMonth) {
                showNotification('Please select a month', 'error');
                return;
            }
            
            const reportContent = document.getElementById('monthlyReportContent');
            
            // Filter employees for selected financial year and mandal
            let filteredEmployees = employees.filter(emp => emp.financialYear === financialYear);
            if (mandalFilter !== 'all') {
                filteredEmployees = filteredEmployees.filter(emp => emp.mandal === mandalFilter);
            }
            
            if (filteredEmployees.length === 0) {
                reportContent.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-calendar-x"></i>
                        <p>No employees found for selected criteria</p>
                    </div>
                `;
                return;
            }
            
            // Create table
            let tableHTML = `
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>GPF Account No</th>
                            <th>Employee Name</th>
                            <th>Designation</th>
                            <th>Mandal</th>
                            <th>OB</th>
                            <th>Subscription</th>
                            <th>DA + PF Recovery</th>
                            <th>Withdrawal</th>
                            <th>CB</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let totalOB = 0;
            let totalSubscription = 0;
            let totalDA = 0;
            let totalWithdrawal = 0;
            let totalCB = 0;
            
            filteredEmployees.forEach(emp => {
                // Find transaction for the selected month
                const monthTransaction = emp.transactions.find(t => t.month === selectedMonth);
                
                if (monthTransaction) {
                    tableHTML += `
                        <tr>
                            <td>${emp.gpfAccountNo}</td>
                            <td>${emp.name}</td>
                            <td>${emp.designation}</td>
                            <td>${emp.mandal}</td>
                            <td>${monthTransaction.ob.toLocaleString('en-IN')}</td>
                            <td>${monthTransaction.subscription.toLocaleString('en-IN')}</td>
                            <td>${monthTransaction.recovery.toLocaleString('en-IN')}</td>
                            <td>${monthTransaction.loan.toLocaleString('en-IN')}</td>
                            <td>${monthTransaction.cb.toLocaleString('en-IN')}</td>
                        </tr>
                    `;
                    
                    totalOB += monthTransaction.ob;
                    totalSubscription += monthTransaction.subscription;
                    totalDA += monthTransaction.recovery;
                    totalWithdrawal += monthTransaction.loan;
                    totalCB += monthTransaction.cb;
                } else {
                    // Employee has no transaction for this month
                    tableHTML += `
                        <tr>
                            <td>${emp.gpfAccountNo}</td>
                            <td>${emp.name}</td>
                            <td>${emp.designation}</td>
                            <td>${emp.mandal}</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    `;
                }
            });
            
            tableHTML += `
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4">TOTAL</td>
                            <td>${totalOB.toLocaleString('en-IN')}</td>
                            <td>${totalSubscription.toLocaleString('en-IN')}</td>
                            <td>${totalDA.toLocaleString('en-IN')}</td>
                            <td>${totalWithdrawal.toLocaleString('en-IN')}</td>
                            <td>${totalCB.toLocaleString('en-IN')}</td>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            reportContent.innerHTML = tableHTML;
            showNotification('Monthly report generated successfully!', 'success');
        }
        
        // Generate Annual Report
        function generateAnnualReport() {
            const financialYear = document.getElementById('annualReportFinancialYear').value;
            const reportType = document.getElementById('reportType').value;
            const mandalFilter = document.getElementById('annualReportMandal').value;
            
            const reportContent = document.getElementById('annualReportContent');
            
            // Filter employees for selected financial year and mandal
            let filteredEmployees = employees.filter(emp => emp.financialYear === financialYear);
            if (mandalFilter !== 'all') {
                filteredEmployees = filteredEmployees.filter(emp => emp.mandal === mandalFilter);
            }
            
            if (filteredEmployees.length === 0) {
                reportContent.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-calendar-x"></i>
                        <p>No employees found for selected criteria</p>
                    </div>
                `;
                return;
            }
            
            if (reportType === 'summary') {
                // Summary Report
                let tableHTML = `
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>GPF Account No</th>
                                <th>Employee Name</th>
                                <th>Mandal</th>
                                <th>Opening Balance</th>
                                <th>Total Subscription</th>
                                <th>Total DA + PF Recovery</th>
                                <th>Total Withdrawal</th>
                                <th>Interest (7.1%)</th>
                                <th>Closing Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                let totalOB = 0;
                let totalSubscription = 0;
                let totalDA = 0;
                let totalWithdrawal = 0;
                let totalInterest = 0;
                let totalCB = 0;
                
                filteredEmployees.forEach(emp => {
                    const summary = calculateSummary(emp);
                    
                    tableHTML += `
                        <tr>
                            <td>${emp.gpfAccountNo}</td>
                            <td>${emp.name}</td>
                            <td>${emp.mandal}</td>
                            <td>${summary.totalOB.toLocaleString('en-IN')}</td>
                            <td>${summary.totalSubscription.toLocaleString('en-IN')}</td>
                            <td>${summary.totalDA.toLocaleString('en-IN')}</td>
                            <td>${summary.totalLoan.toLocaleString('en-IN')}</td>
                            <td>${summary.interest.toLocaleString('en-IN')}</td>
                            <td>${summary.closingBalance.toLocaleString('en-IN')}</td>
                        </tr>
                    `;
                    
                    totalOB += summary.totalOB;
                    totalSubscription += summary.totalSubscription;
                    totalDA += summary.totalDA;
                    totalWithdrawal += summary.totalLoan;
                    totalInterest += summary.interest;
                    totalCB += summary.closingBalance;
                });
                
                tableHTML += `
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="3">TOTAL</td>
                                <td>${totalOB.toLocaleString('en-IN')}</td>
                                <td>${totalSubscription.toLocaleString('en-IN')}</td>
                                <td>${totalDA.toLocaleString('en-IN')}</td>
                                <td>${totalWithdrawal.toLocaleString('en-IN')}</td>
                                <td>${totalInterest.toLocaleString('en-IN')}</td>
                                <td>${totalCB.toLocaleString('en-IN')}</td>
                            </tr>
                        </tfoot>
                    </table>
                `;
                
                reportContent.innerHTML = tableHTML;
            } else if (reportType === 'detailed') {
                // Detailed Report - Show all months for each employee
                let tableHTML = `
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>GPF Account No</th>
                                <th>Employee Name</th>
                                <th>Mandal</th>
                                <th>Month</th>
                                <th>OB</th>
                                <th>Subscription</th>
                                <th>DA + PF Recovery</th>
                                <th>Withdrawal</th>
                                <th>CB</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                filteredEmployees.forEach(emp => {
                    if (emp.transactions.length > 0) {
                        emp.transactions.forEach(trans => {
                            tableHTML += `
                                <tr>
                                    <td>${emp.gpfAccountNo}</td>
                                    <td>${emp.name}</td>
                                    <td>${emp.mandal}</td>
                                    <td>${trans.month}</td>
                                    <td>${trans.ob.toLocaleString('en-IN')}</td>
                                    <td>${trans.subscription.toLocaleString('en-IN')}</td>
                                    <td>${trans.recovery.toLocaleString('en-IN')}</td>
                                    <td>${trans.loan.toLocaleString('en-IN')}</td>
                                    <td>${trans.cb.toLocaleString('en-IN')}</td>
                                </tr>
                            `;
                        });
                    } else {
                        tableHTML += `
                            <tr>
                                <td>${emp.gpfAccountNo}</td>
                                <td>${emp.name}</td>
                                <td>${emp.mandal}</td>
                                <td colspan="6">No transactions recorded</td>
                            </tr>
                        `;
                    }
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
                
                reportContent.innerHTML = tableHTML;
            }
            
            showNotification('Annual report generated successfully!', 'success');
        }
        
        // Generate Employee Summary
        function generateEmployeeSummary() {
            const employeeId = document.getElementById('summaryEmployeeSelect').value;
            const financialYear = document.getElementById('summaryFinancialYear').value;
            const mandalFilter = document.getElementById('summaryMandal').value;
            
            const reportContent = document.getElementById('employeeSummaryContent');
            
            if (employeeId === 'all') {
                // Show summary for all employees
                let filteredEmployees = employees.filter(emp => emp.financialYear === financialYear);
                if (mandalFilter !== 'all') {
                    filteredEmployees = filteredEmployees.filter(emp => emp.mandal === mandalFilter);
                }
                
                if (filteredEmployees.length === 0) {
                    reportContent.innerHTML = `
                        <div class="empty-state">
                            <i class="bi bi-person-x"></i>
                            <p>No employees found for selected criteria</p>
                        </div>
                    `;
                    return;
                }
                
                let tableHTML = `
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>GPF Account No</th>
                                <th>Employee Name</th>
                                <th>Designation</th>
                                <th>Mandal</th>
                                <th>Place Of Work</th>
                                <th>Opening Balance</th>
                                <th>Total Subscription</th>
                                <th>Total DA + PF Recovery</th>
                                <th>Total Withdrawal</th>
                                <th>Interest (7.1%)</th>
                                <th>Closing Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                let totalOB = 0;
                let totalSubscription = 0;
                let totalDA = 0;
                let totalWithdrawal = 0;
                let totalInterest = 0;
                let totalCB = 0;
                
                filteredEmployees.forEach(emp => {
                    const summary = calculateSummary(emp);
                    
                    tableHTML += `
                        <tr>
                            <td>${emp.gpfAccountNo}</td>
                            <td>${emp.name}</td>
                            <td>${emp.designation}</td>
                            <td>${emp.mandal}</td>
                            <td>${emp.placeOfWork}</td>
                            <td>${summary.totalOB.toLocaleString('en-IN')}</td>
                            <td>${summary.totalSubscription.toLocaleString('en-IN')}</td>
                            <td>${summary.totalDA.toLocaleString('en-IN')}</td>
                            <td>${summary.totalLoan.toLocaleString('en-IN')}</td>
                            <td>${summary.interest.toLocaleString('en-IN')}</td>
                            <td>${summary.closingBalance.toLocaleString('en-IN')}</td>
                        </tr>
                    `;
                    
                    totalOB += summary.totalOB;
                    totalSubscription += summary.totalSubscription;
                    totalDA += summary.totalDA;
                    totalWithdrawal += summary.totalLoan;
                    totalInterest += summary.interest;
                    totalCB += summary.closingBalance;
                });
                
                tableHTML += `
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="5">TOTAL</td>
                                <td>${totalOB.toLocaleString('en-IN')}</td>
                                <td>${totalSubscription.toLocaleString('en-IN')}</td>
                                <td>${totalDA.toLocaleString('en-IN')}</td>
                                <td>${totalWithdrawal.toLocaleString('en-IN')}</td>
                                <td>${totalInterest.toLocaleString('en-IN')}</td>
                                <td>${totalCB.toLocaleString('en-IN')}</td>
                            </tr>
                        </tfoot>
                    </table>
                `;
                
                reportContent.innerHTML = tableHTML;
            } else {
                // Show detailed summary for the selected employee
                const employee = employees.find(emp => emp.id == employeeId && emp.financialYear === financialYear);
                
                if (!employee) {
                    reportContent.innerHTML = `
                        <div class="empty-state">
                            <i class="bi bi-person-x"></i>
                            <p>Employee not found for the selected financial year</p>
                        </div>
                    `;
                    return;
                }
                
                const summary = calculateSummary(employee);
                
                let tableHTML = `
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Employee Details</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>GPF Account No:</strong> ${employee.gpfAccountNo}</p>
                                    <p><strong>Employee Name:</strong> ${employee.name}</p>
                                    <p><strong>Designation:</strong> ${employee.designation}</p>
                                    <p><strong>Mandal:</strong> ${employee.mandal}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Place Of Work:</strong> ${employee.placeOfWork}</p>
                                    <p><strong>Financial Year:</strong> ${employee.financialYear}</p>
                                    <p><strong>Opening Balance:</strong> ${employee.openingBalance.toLocaleString('en-IN')}</p>
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mt-3 mb-2">Annual Summary</h6>
                        <table class="table table-sm table-bordered">
                            <tr>
                                <td width="40%">Opening Balance</td>
                                <td class="text-end">${summary.totalOB.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Total Subscription</td>
                                <td class="text-end">${summary.totalSubscription.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Total DA + PF Recovery</td>
                                <td class="text-end">${summary.totalDA.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Total Withdrawal</td>
                                <td class="text-end">${summary.totalLoan.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Cumulative (Sum of all CB)</td>
                                <td class="text-end">${summary.cumulative.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Interest (7.1% p.a.)</td>
                                <td class="text-end">${summary.interest.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Gross (OB + Subscription + Interest)</td>
                                <td class="text-end">${summary.gross.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr class="table-primary">
                                <td>Closing Balance</td>
                                <td class="text-end">${summary.closingBalance.toLocaleString('en-IN')}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                `;
                
                reportContent.innerHTML = tableHTML;
            }
            
            showNotification('Employee summary generated successfully!', 'success');
        }
        
        // Print Monthly Report - Modified to print from current page with header
        function printMonthlyReport() {
            const financialYear = document.getElementById('reportFinancialYear').value;
            const mandalFilter = document.getElementById('monthlyReportMandal').value;
            
            if (!selectedMonth) {
                showNotification('Please select a month first', 'error');
                return;
            }
            
            // Generate report content if not already generated
            if (document.getElementById('monthlyReportContent').querySelector('.empty-state')) {
                generateMonthlyReport();
            }
            
            // Create a comprehensive print stylesheet
            const printStyles = document.createElement('style');
            printStyles.innerHTML = `
                @media print {
                    body {
                        font-family: Arial, sans-serif;
                        margin: 10mm;
                        font-size: 8px;
                    }
                    
                    /* Hide elements that shouldn't be printed */
                    .no-print {
                        display: none !important;
                    }
                    
                    .report-filters {
                        display: none !important;
                    }
                    
                    .report-actions {
                        display: none !important;
                    }
                    
                    .print-footer {
                        display: none !important;
                    }
                    
                    /* Show print header */
                    .print-header {
                        display: block !important;
                        visibility: visible !important;
                        text-align: center;
                        margin-bottom: 15px;
                        padding: 10px;
                        border-bottom: 2px solid #4a7ca7;
                    }
                    
                    .print-header h1 {
                        font-size: 12px !important;
                        font-weight: bold !important;
                        margin-bottom: 5px !important;
                        color: #4a7ca7 !important;
                    }
                    
                    .print-header h2 {
                        font-size: 10px !important;
                        margin-bottom: 0 !important;
                        color: #6c9bd2 !important;
                    }
                    
                    /* Show navbar in print */
                    .navbar {
                        display: flex !important;
                        background: linear-gradient(to right, #4a7ca7, #6c9bd2) !important;
                        color: white !important;
                        padding: 10px !important;
                        margin-bottom: 10px !important;
                        align-items: center !important;
                    }
                    
                    .navbar-brand {
                        display: flex !important;
                        align-items: center !important;
                        color: white !important;
                        font-weight: bold !important;
                    }
                    
                    .navbar-brand img {
                        height: 40px !important;
                        margin-right: 10px !important;
                        border-radius: 50% !important;
                    }
                    
                    /* Add print title */
                    .print-title {
                        display: block !important;
                        text-align: center;
                        margin-bottom: 15px;
                        font-size: 12px;
                        font-weight: bold;
                    }
                    
                    /* Style report table for printing */
                    .report-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        margin-bottom: 15px !important;
                        font-size: 8px !important;
                    }
                    
                    .report-table th {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        border: 1px solid #ddd !important;
                        padding: 5px !important;
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .report-table td {
                        border: 1px solid #ddd !important;
                        padding: 5px !important;
                    }
                    
                    .report-table td:nth-child(n+5) {
                        text-align: right !important;
                    }
                    
                    .total-row {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    .total-row td {
                        border-top: 2px solid #4a7ca7 !important;
                    }
                    
                    /* Add print footer */
                    body::after {
                        content: "Generated on: ${new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' })}";
                        display: block;
                        text-align: center;
                        margin-top: 20px;
                        font-size: 9px;
                        color: #666;
                    }
                }
            `;
            
            // Add print header to page
            const printHeader = document.createElement('div');
            printHeader.className = 'print-header';
            printHeader.innerHTML = `
                <h1>ZILLA PARISHAD GENERAL PROVIDENT FUND</h1>
                <h2>ANDHRA PRADESH, SPSR NELLORE DISTRICT</h2>
            `;
            
            // Add print title
            const printTitle = document.createElement('div');
            printTitle.className = 'print-title';
            printTitle.innerHTML = `
                Monthly GPF Report - ${selectedMonth} ${financialYear}
            `;
            
            // Insert print elements at the beginning of body
            document.body.insertBefore(printHeader, document.body.firstChild);
            document.body.insertBefore(printTitle, document.body.childNodes[1]);
            
            // Add print styles to document
            document.head.appendChild(printStyles);
            
            // Trigger print dialog
            window.print();
            
            // Remove print styles and elements after printing
            setTimeout(() => {
                document.head.removeChild(printStyles);
                document.body.removeChild(printHeader);
                document.body.removeChild(printTitle);
            }, 1000);
        }
        
        // Print Annual Report - Modified to print from current page with header
        function printAnnualReport() {
            const financialYear = document.getElementById('annualReportFinancialYear').value;
            const reportType = document.getElementById('reportType').value;
            const mandalFilter = document.getElementById('annualReportMandal').value;
            
            // Generate report content if not already generated
            if (document.getElementById('annualReportContent').querySelector('.empty-state')) {
                generateAnnualReport();
            }
            
            // Create a comprehensive print stylesheet
            const printStyles = document.createElement('style');
            printStyles.innerHTML = `
                @media print {
                    body {
                        font-family: Arial, sans-serif;
                        margin: 10mm;
                        font-size: 10px;
                    }
                    
                    /* Hide elements that shouldn't be printed */
                    .no-print {
                        display: none !important;
                    }
                    
                    .report-filters {
                        display: none !important;
                    }
                    
                    .report-actions {
                        display: none !important;
                    }
                    
                    .print-footer {
                        display: none !important;
                    }
                    
                    /* Show print header */
                    .print-header {
                        display: block !important;
                        visibility: visible !important;
                        text-align: center;
                        margin-bottom: 15px;
                        padding: 10px;
                        border-bottom: 2px solid #4a7ca7;
                    }
                    
                    .print-header h1 {
                        font-size: 18px !important;
                        font-weight: bold !important;
                        margin-bottom: 5px !important;
                        color: #4a7ca7 !important;
                    }
                    
                    .print-header h2 {
                        font-size: 14px !important;
                        margin-bottom: 0 !important;
                        color: #6c9bd2 !important;
                    }
                    
                    /* Show navbar in print */
                    .navbar {
                        display: flex !important;
                        background: linear-gradient(to right, #4a7ca7, #6c9bd2) !important;
                        color: white !important;
                        padding: 10px !important;
                        margin-bottom: 10px !important;
                        align-items: center !important;
                    }
                    
                    .navbar-brand {
                        display: flex !important;
                        align-items: center !important;
                        color: white !important;
                        font-weight: bold !important;
                    }
                    
                    .navbar-brand img {
                        height: 40px !important;
                        margin-right: 10px !important;
                        border-radius: 50% !important;
                    }
                    
                    /* Add print title */
                    .print-title {
                        display: block !important;
                        text-align: center;
                        margin-bottom: 15px;
                        font-size: 16px;
                        font-weight: bold;
                    }
                    
                    /* Style report table for printing */
                    .report-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        margin-bottom: 15px !important;
                        font-size: 12px !important;
                    }
                    
                    .report-table th {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        border: 1px solid #ddd !important;
                        padding: 5px !important;
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .report-table td {
                        border: 1px solid #ddd !important;
                        padding: 5px !important;
                    }
                    
                    .report-table td:nth-child(n+4) {
                        text-align: right !important;
                    }
                    
                    .total-row {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    .total-row td {
                        border-top: 2px solid #4a7ca7 !important;
                    }
                    
                    /* Style card elements for printing */
                    .card {
                        border: 1px solid #ddd !important;
                        margin-bottom: 15px !important;
                        page-break-inside: avoid !important;
                    }
                    
                    .card-header {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        padding: 5px !important;
                        font-weight: bold !important;
                    }
                    
                    .card-body {
                        padding: 10px !important;
                    }
                    
                    .table-sm {
                        width: 100% !important;
                        border-collapse: collapse !important;
                    }
                    
                    .table-sm td {
                        border: 1px solid #ddd !important;
                        padding: 3px !important;
                    }
                    
                    .table-sm td:first-child {
                        width: 40% !important;
                        font-weight: bold !important;
                    }
                    
                    .table-sm td:last-child {
                        text-align: right !important;
                    }
                    
                    .table-primary {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    /* Add print footer */
                    body::after {
                        content: "Generated on: ${new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' })}";
                        display: block;
                        text-align: center;
                        margin-top: 20px;
                        font-size: 9px;
                        color: #666;
                    }
                }
            `;
            
            // Add print header to page
            const printHeader = document.createElement('div');
            printHeader.className = 'print-header';
            printHeader.innerHTML = `
                <h1>ZILLA PARISHAD GENERAL PROVIDENT FUND</h1>
                <h2>ANDHRA PRADESH, SPSR NELLORE DISTRICT</h2>
            `;
            
            // Add print title
            const printTitle = document.createElement('div');
            printTitle.className = 'print-title';
            printTitle.innerHTML = `
                Annual ${reportType} Report - ${financialYear}
            `;
            
            // Insert print elements at the beginning of body
            document.body.insertBefore(printHeader, document.body.firstChild);
            document.body.insertBefore(printTitle, document.body.childNodes[1]);
            
            // Add print styles to document
            document.head.appendChild(printStyles);
            
            // Trigger print dialog
            window.print();
            
            // Remove print styles and elements after printing
            setTimeout(() => {
                document.head.removeChild(printStyles);
                document.body.removeChild(printHeader);
                document.body.removeChild(printTitle);
            }, 1000);
        }
        
        // Print Employee Summary - Modified to print from current page with header
        function printEmployeeSummary() {
            const employeeId = document.getElementById('summaryEmployeeSelect').value;
            const financialYear = document.getElementById('summaryFinancialYear').value;
            const mandalFilter = document.getElementById('summaryMandal').value;
            
            // Generate report content if not already generated
            if (document.getElementById('employeeSummaryContent').querySelector('.empty-state')) {
                generateEmployeeSummary();
            }
            
            // Create a comprehensive print stylesheet
            const printStyles = document.createElement('style');
            printStyles.innerHTML = `
                @media print {
                    body {
                        font-family: Arial, sans-serif;
                        margin: 10mm;
                        font-size: 8px;
                    }
                    
                    /* Hide elements that shouldn't be printed */
                    .no-print {
                        display: none !important;
                    }
                    
                    .report-filters {   
                        display: none !important;
                    }
                    
                    .report-actions {
                        display: none !important;
                    }
                    
                    .print-footer {
                        display: none !important;
                    }
                    
                    /* Show print header */
                    .print-header {
                        display: block !important;
                        visibility: visible !important;
                        text-align: center;
                        margin-bottom: 15px;
                        padding: 10px;
                        border-bottom: 2px solid #4a7ca7;
                    }
                    
                    .print-header h1 {
                        font-size: 14px !important;
                        font-weight: bold !important;
                        margin-bottom: 5px !important;
                        color: #4a7ca7 !important;
                    }
                    
                    .print-header h2 {
                        font-size: 10px !important;
                        margin-bottom: 0 !important;
                        color: #6c9bd2 !important;
                    }
                    
                    /* Show navbar in print */
                    .navbar {
                        display: flex !important;
                        background: linear-gradient(to right, #4a7ca7, #6c9bd2) !important;
                        color: white !important;
                        padding: 10px !important;
                        margin-bottom: 10px !important;
                        align-items: center !important;
                    }
                    
                    .navbar-brand {
                        display: flex !important;
                        align-items: center !important;
                        color: white !important;
                        font-weight: bold !important;
                    }
                    
                    .navbar-brand img {
                        height: 40px !important;
                        margin-right: 10px !important;
                        border-radius: 50% !important;
                    }
                    
                    /* Add print title */
                    .print-title {
                        display: block !important;
                        text-align: center;
                        margin-bottom: 15px;
                        font-size: 16px;
                        font-weight: bold;
                    }
                    
                    /* Style report table for printing */
                    .report-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        margin-bottom: 15px !important;
                        font-size: 12px !important;
                    }
                    
                    .report-table th {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        border: 1px solid #ddd !important;
                        padding: 5px !important;
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .report-table td {
                        border: 1px solid #ddd !important;
                        padding: 5px !important;
                    }
                    
                    .report-table td:nth-child(n+6) {
                        text-align: right !important;
                    }
                    
                    .total-row {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    .total-row td {
                        border-top: 2px solid #4a7ca7 !important;
                    }
                    
                    /* Style card elements for printing */
                    .card {
                        border: 1px solid #ddd !important;
                        margin-bottom: 15px !important;
                        page-break-inside: avoid !important;
                    }
                    
                    .card-header {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        padding: 5px !important;
                        font-weight: bold !important;
                    }
                    
                    .card-body {
                        padding: 10px !important;
                    }
                    
                    .table-sm {
                        width: 100% !important;
                        border-collapse: collapse !important;
                    }
                    
                    .table-sm td {
                        border: 1px solid #ddd !important;
                        padding: 3px !important;
                    }
                    
                    .table-sm td:first-child {
                        width: 60% !important;
                        font-weight: bold !important;
                    }
                    
                    .table-sm td:last-child {
                        text-align: right !important;
                    }
                    
                    .table-primary {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    /* Add print footer */
                    body::after {
                        content: "Generated on: ${new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' })}";
                        display: block;
                        text-align: center;
                        margin-top: 20px;
                        font-size: 9px;
                        color: #666;
                    }
                }
            `;
            
            // Add print header to page
            const printHeader = document.createElement('div');
            printHeader.className = 'print-header';
            printHeader.innerHTML = `
                <h1>ZILLA PARISHAD GENERAL PROVIDENT FUND</h1>
                <h2>ANDHRA PRADESH, SPSR NELLORE DISTRICT</h2>
            `;
            
            // Add print title
            const printTitle = document.createElement('div');
            printTitle.className = 'print-title';
            printTitle.innerHTML = `
                Employee Summary Report - ${financialYear}
            `;
            
            // Insert print elements at the beginning of body
            document.body.insertBefore(printHeader, document.body.firstChild);
            document.body.insertBefore(printTitle, document.body.childNodes[1]);
            
            // Add print styles to document
            document.head.appendChild(printStyles);
            
            // Trigger print dialog
            window.print();
            
            // Remove print styles and elements after printing
            setTimeout(() => {
                document.head.removeChild(printStyles);
                document.body.removeChild(printHeader);
                document.body.removeChild(printTitle);
            }, 1000);
        }
        
        // Print Record - Modified to print from current page with header
        function printRecord() {
            if (!currentEmployee) {
                showNotification('Please select an employee first', 'error');
                return;
            }
            
            if (isEditMode) {
                showNotification('Please exit edit mode before printing', 'error');
                return;
            }
            
            // Create a comprehensive print stylesheet
            const printStyles = document.createElement('style');
            printStyles.innerHTML = `
                @media print {
                    body {
                        font-family: Arial, sans-serif;
                        margin: 10mm;
                        font-size: 6px;
                    }
                    
                    /* Hide all elements except what we want to print */
                    body > *:not(.print-container):not(.print-container *) {
                        display: none !important;
                    }
                    
                    /* Create print container */
                    .print-container {
                        display: block !important;
                        position: relative !important;
                        width: 100% !important;
                        height: auto !important;
                        overflow: visible !important;
                        background: white !important;
                        color: black !important;
                    }
                    
                    /* Print header styles */
                    .print-header {
                        display: block !important;
                        visibility: visible !important;
                        text-align: center !important;
                        margin-bottom: 10px !important;
                        padding: 15px !important;
                        border-bottom: 2px solid #4a7ca7 !important;
                        page-break-after: avoid !important;
                    }
                    
                    .print-header h1 {
                        font-size: 8px !important;
                        font-weight: bold !important;
                        margin-bottom: 5px !important;
                        color: #4a7ca7 !important;
                    }
                    
                    .print-header h2 {
                        font-size: 6px !important;
                        margin-bottom: 0 !important;
                        color: #6c9bd2 !important;
                    }
                    
                    /* Print navbar */
                    .print-navbar {
                        display: flex !important;
                        background: linear-gradient(to right, #4a7ca7, #6c9bd2) !important;
                        color: white !important;
                        padding: 10px !important;
                        margin-bottom: 10px !important;
                        align-items: center !important;
                        page-break-after: avoid !important;
                    }
                    
                    .print-navbar-brand {
                        display: flex !important;
                        align-items: center !important;
                        color: white !important;
                        font-weight: bold !important;
                    }
                    
                    .print-navbar img {
                        height: 40px !important;
                        margin-right: 10px !important;
                        border-radius: 50% !important;
                    }
                    
                    /* Employee details */
                    .print-details {
                        margin-bottom: 20px !important;
                        padding: 15px !important;
                        background-color: #f5f8fc !important;
                        border: 1px solid #ddd !important;
                    }
                    
                    .print-detail-row {
                        display: flex !important;
                        margin-bottom: 8px !important;
                        font-size: 8px !important;
                    }
                    
                    .print-detail-label {
                        font-weight: bold !important;
                        width: 180px !important;
                    }
                    
                    .print-detail-value {
                        flex: 1 !important;
                    }
                    
                    /* Summary table */
                    .print-summary {
                        margin-top: 10px !important;
                    }
                    
                    .print-summary-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        font-size: 8px !important;
                    }
                    
                    .print-summary-table th {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        border: 1px solid #ddd !important;
                        padding: 8px !important;
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .print-summary-table td {
                        border: 1px solid #ddd !important;
                        padding: 8px !important;
                    }
                    
                    .print-summary-table td:first-child {
                        font-weight: bold !important;
                        width: 60% !important;
                    }
                    
                    .print-summary-table td:last-child {
                        text-align: right !important;
                    }
                    
                    .print-highlight {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    /* Print footer */
                    .print-footer {
                        position: fixed !important;
                        bottom: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        text-align: center !important;
                        padding: 10px !important;
                        font-size: 9px !important;
                        color: #666 !important;
                        border-top: 1px solid #ddd !important;
                    }
                    
                    /* Override all other styles */
                    body {
                        font-family: Arial, sans-serif !important;
                        margin: 0 !important;
                        padding: 0 !important;
                        background: white !important;
                        color: black !important;
                        font-size: 6px !important;
                    }
                }
            `;
            
            // Get the summary
            const summary = calculateSummary(currentEmployee);
            
            // Create print container with all content
            const printContainer = document.createElement('div');
            printContainer.className = 'print-container';
            printContainer.innerHTML = `
                <div class="print-navbar">
                    <div class="print-navbar-brand">
                        
                    </div>
                </div>
                
                <div class="print-header">
                    
                </div>
                
                <div class="print-details">
                    
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                    <div class="print-detail-row">
                        
                    </div>
                </div>
                
                <div class="print-summary">
                    
                </div>
                
                <div class="print-footer">
                   
                </div>
            `;
            
            // Hide all body content
            document.body.style.display = 'none';
            
            // Add print container to body
            document.body.appendChild(printContainer);
            document.body.style.display = 'block';
            
            // Add print styles to document
            document.head.appendChild(printStyles);
            
            // Trigger print dialog
            window.print();
            
            // Restore original state after printing
            setTimeout(() => {
                document.head.removeChild(printStyles);
                document.body.removeChild(printContainer);
                document.body.style.display = '';
            }, 1000);
        }
        
        // Export Monthly Report to Excel
        function exportMonthlyReportToExcel() {
            const financialYear = document.getElementById('reportFinancialYear').value;
            const mandalFilter = document.getElementById('monthlyReportMandal').value;
            
            if (!selectedMonth) {
                showNotification('Please select a month first', 'error');
                return;
            }
            
            let filteredEmployees = employees.filter(emp => emp.financialYear === financialYear);
            if (mandalFilter !== 'all') {
                filteredEmployees = filteredEmployees.filter(emp => emp.mandal === mandalFilter);
            }
            
            if (filteredEmployees.length === 0) {
                showNotification('No data to export', 'error');
                return;
            }
            
            const excelData = [];
            
            // Add header row
            excelData.push({
                'GPF Account No': 'GPF Account No',
                'Employee Name': 'Employee Name',
                'Designation': 'Designation',
                'Mandal': 'Mandal',
                'OB': 'OB',
                'Subscription': 'Subscription',
                'DA + PF Recovery': 'DA + PF Recovery',
                'Withdrawal': 'Withdrawal',
                'CB': 'CB'
            });
            
            // Add employee data
            filteredEmployees.forEach(emp => {
                const monthTransaction = emp.transactions.find(t => t.month === selectedMonth);
                
                if (monthTransaction) {
                    excelData.push({
                        'GPF Account No': emp.gpfAccountNo,
                        'Employee Name': emp.name,
                        'Designation': emp.designation,
                        'Mandal': emp.mandal,
                        'OB': monthTransaction.ob,
                        'Subscription': monthTransaction.subscription,
                        'DA + PF Recovery': monthTransaction.recovery,
                        'Withdrawal': monthTransaction.loan,
                        'CB': monthTransaction.cb
                    });
                } else {
                    // Employee has no transaction for this month
                    excelData.push({
                        'GPF Account No': emp.gpfAccountNo,
                        'Employee Name': emp.name,
                        'Designation': emp.designation,
                        'Mandal': emp.mandal,
                        'OB': '-',
                        'Subscription': '-',
                        'DA + PF Recovery': '-',
                        'Withdrawal': '-',
                        'CB': '-'
                    });
                }
            });
            
            // Create workbook
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Monthly Report');
            
            // Generate filename
            const filename = `Monthly_Report_${selectedMonth}_${financialYear}${mandalFilter !== 'all' ? '_' + mandalFilter : ''}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, filename);
            showNotification('Monthly report exported to Excel successfully!', 'success');
        }
        
        // Export Annual Report to Excel
        function exportAnnualReportToExcel() {
            const financialYear = document.getElementById('annualReportFinancialYear').value;
            const reportType = document.getElementById('reportType').value;
            const mandalFilter = document.getElementById('annualReportMandal').value;
            
            let filteredEmployees = employees.filter(emp => emp.financialYear === financialYear);
            if (mandalFilter !== 'all') {
                filteredEmployees = filteredEmployees.filter(emp => emp.mandal === mandalFilter);
            }
            
            if (filteredEmployees.length === 0) {
                showNotification('No data to export', 'error');
                return;
            }
            
            const excelData = [];
            
            if (reportType === 'summary') {
                // Summary Report
                excelData.push({
                    'GPF Account No': 'GPF Account No',
                    'Employee Name': 'Employee Name',
                    'Mandal': 'Mandal',
                    'Opening Balance': 'Opening Balance',
                    'Total Subscription': 'Total Subscription',
                    'Total DA + PF Recovery': 'Total DA + PF Recovery',
                    'Total Withdrawal': 'Total Withdrawal',
                    'Interest (7.1%)': 'Interest (7.1%)',
                    'Closing Balance': 'Closing Balance'
                });
                
                filteredEmployees.forEach(emp => {
                    const summary = calculateSummary(emp);
                    excelData.push({
                        'GPF Account No': emp.gpfAccountNo,
                        'Employee Name': emp.name,
                        'Mandal': emp.mandal,
                        'Opening Balance': summary.totalOB,
                        'Total Subscription': summary.totalSubscription,
                        'Total DA + PF Recovery': summary.totalDA,
                        'Total Withdrawal': summary.totalLoan,
                        'Interest (7.1%)': summary.interest,
                        'Closing Balance': summary.closingBalance
                    });
                });
            } else if (reportType === 'detailed') {
                // Detailed Report
                excelData.push({
                    'GPF Account No': 'GPF Account No',
                    'Employee Name': 'Employee Name',
                    'Mandal': 'Mandal',
                    'Month': 'Month',
                    'OB': 'OB',
                    'Subscription': 'Subscription',
                    'DA + PF Recovery': 'DA + PF Recovery',
                    'Withdrawal': 'Withdrawal',
                    'CB': 'CB'
                });
                
                filteredEmployees.forEach(emp => {
                    if (emp.transactions.length > 0) {
                        emp.transactions.forEach(trans => {
                            excelData.push({
                                'GPF Account No': emp.gpfAccountNo,
                                'Employee Name': emp.name,
                                'Mandal': emp.mandal,
                                'Month': trans.month,
                                'OB': trans.ob,
                                'Subscription': trans.subscription,
                                'DA + PF Recovery': trans.recovery,
                                'Withdrawal': trans.loan,
                                'CB': trans.cb
                            });
                        });
                    } else {
                        excelData.push({
                            'GPF Account No': emp.gpfAccountNo,
                            'Employee Name': emp.name,
                            'Mandal': emp.mandal,
                            'Month': 'No transactions',
                            'OB': '-',
                            'Subscription': '-',
                            'DA + PF Recovery': '-',
                            'Withdrawal': '-',
                            'CB': '-'
                        });
                    }
                });
            }
            
            // Create workbook
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Annual Report');
            
            // Generate filename
            const filename = `Annual_Report_${reportType}_${financialYear}${mandalFilter !== 'all' ? '_' + mandalFilter : ''}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, filename);
            showNotification('Annual report exported to Excel successfully!', 'success');
        }
        
        // Export Employee Summary to Excel
        function exportEmployeeSummaryToExcel() {
            const employeeId = document.getElementById('summaryEmployeeSelect').value;
            const financialYear = document.getElementById('summaryFinancialYear').value;
            const mandalFilter = document.getElementById('summaryMandal').value;
            
            if (employeeId === 'all') {
                // Export all employees summary
                let filteredEmployees = employees.filter(emp => emp.financialYear === financialYear);
                if (mandalFilter !== 'all') {
                    filteredEmployees = filteredEmployees.filter(emp => emp.mandal === mandalFilter);
                }
                
                if (filteredEmployees.length === 0) {
                    showNotification('No data to export', 'error');
                    return;
                }
                
                const excelData = [];
                
                // Add header row
                excelData.push({
                    'GPF Account No': 'GPF Account No',
                    'Employee Name': 'Employee Name',
                    'Designation': 'Designation',
                    'Mandal': 'Mandal',
                    'Place Of Work': 'Place Of Work',
                    'Financial Year': 'Financial Year',
                    'Opening Balance': 'Opening Balance'
                });
                
                // Add employee data
                filteredEmployees.forEach(emp => {
                    const summary = calculateSummary(emp);
                    excelData.push({
                        'GPF Account No': emp.gpfAccountNo,
                        'Employee Name': emp.name,
                        'Designation': emp.designation,
                        'Mandal': emp.mandal,
                        'Place Of Work': emp.placeOfWork,
                        'Financial Year': emp.financialYear,
                        'Opening Balance': summary.totalOB,
                        'Total Subscription': summary.totalSubscription,
                        'Total DA + PF Recovery': summary.totalDA,
                        'Total Withdrawal': summary.totalLoan,
                        'Interest (7.1%)': summary.interest,
                        'Gross (OB + Subscription + Interest)': summary.gross,
                        'Closing Balance': summary.closingBalance
                    });
                });
                
                // Create workbook
                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Employee Summary');
                
                // Generate filename
                const filename = `Employee_Summary_All_${financialYear}${mandalFilter !== 'all' ? '_' + mandalFilter : ''}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
            } else {
                // Export selected employee details
                const employee = employees.find(emp => emp.id == employeeId && emp.financialYear === financialYear);
                
                if (!employee) {
                    showNotification('Employee not found', 'error');
                    return;
                }
                
                const summary = calculateSummary(employee);
                
                // Create workbook with multiple sheets
                const wb = XLSX.utils.book_new();
                
                // Sheet 1: Employee Details
                const detailsData = [
                    { 'Field': 'GPF Account No', 'Value': employee.gpfAccountNo },
                    { 'Field': 'Employee Name', 'Value': employee.name },
                    { 'Field': 'Designation', 'Value': employee.designation },
                    { 'Field': 'Mandal', 'Value': employee.mandal },
                    { 'Field': 'Place Of Work', 'Value': employee.placeOfWork },
                    { 'Field': 'Financial Year', 'Value': employee.financialYear },
                    { 'Field': 'Opening Balance', 'Value': employee.openingBalance }
                ];
                
                const wsDetails = XLSX.utils.json_to_sheet(detailsData);
                XLSX.utils.book_append_sheet(wb, wsDetails, 'Employee Details');
                
                // Sheet 2: Monthly Transactions
                const transactionsData = [];
                
                if (employee.transactions.length > 0) {
                    transactionsData.push({
                        'Month': 'Month',
                        'OB': 'OB',
                        'Subscription': 'Subscription',
                        'DA + PF Recovery': 'DA + PF Recovery',
                        'Withdrawal': 'Withdrawal',
                        'CB': 'CB'
                    });
                    
                    employee.transactions.forEach(trans => {
                        transactionsData.push({
                            'Month': trans.month,
                            'OB': trans.ob,
                            'Subscription': trans.subscription,
                            'DA + PF Recovery': trans.recovery,
                            'Withdrawal': trans.loan,
                            'CB': trans.cb
                        });
                    });
                } else {
                    transactionsData.push({
                        'Month': 'No transactions',
                        'OB': '-',
                        'Subscription': '-',
                        'DA + PF Recovery': '-',
                        'Withdrawal': '-',
                        'CB': '-'
                    });
                }
                
                const wsTransactions = XLSX.utils.json_to_sheet(transactionsData);
                XLSX.utils.book_append_sheet(wb, wsTransactions, 'Monthly Transactions');
                
                // Sheet 3: Annual Summary
                const summaryData = [
                    { 'Description': 'Opening Balance', 'Amount': summary.totalOB },
                    { 'Description': 'Total Subscription', 'Amount': summary.totalSubscription },
                    { 'Description': 'Total DA + PF Recovery', 'Amount': summary.totalDA },
                    { 'Description': 'Total Withdrawal', 'Amount': summary.totalLoan },
                    { 'Description': 'Cumulative (Sum of all CB)', 'Amount': summary.cumulative },
                    { 'Description': 'Interest (7.1% p.a.)', 'Amount': summary.interest },
                    { 'Description': 'Gross (OB + Subscription + Interest)', 'Amount': summary.gross },
                    { 'Description': 'Closing Balance', 'Amount': summary.closingBalance }
                ];
                
                const wsSummary = XLSX.utils.json_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, wsSummary, 'Annual Summary');
                
                // Generate filename
                const filename = `Employee_Summary_${employee.gpfAccountNo}_${employee.name}_${financialYear}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
            }
            
            showNotification('Employee summary exported to Excel successfully!', 'success');
        }
        
        // Show new employee modal
        function showNewEmployeeModal() {
            document.getElementById('newEmployeeForm').reset();
            const modal = new bootstrap.Modal(document.getElementById('newEmployeeModal'));
            modal.show();
        }
        
        // Save new employee
        function saveNewEmployee() {
            const employee = {
                id: Date.now(),
                gpfAccountNo: document.getElementById('newGpfAccountNo').value,
                name: document.getElementById('newEmployeeName').value,
                designation: document.getElementById('newDesignation').value,
                placeOfWork: document.getElementById('newPlaceOfWork').value,
                mandal: document.getElementById('newMandal').value,
                financialYear: document.getElementById('newFinancialYear').value,
                openingBalance: parseInt(document.getElementById('newOpeningBalance').value) || 0,
                transactions: []
            };
            
            // Check for duplicate account number
            if (employees.find(e => e.gpfAccountNo === employee.gpfAccountNo)) {
                showNotification('GPF Account Number already exists!', 'error');
                return;
            }
            
            employees.push(employee);
            localStorage.setItem('gpfEmployees', JSON.stringify(employees));
            
            bootstrap.Modal.getInstance(document.getElementById('newEmployeeModal')).hide();
            loadEmployee(employee);
            showNotification('Employee added successfully!', 'success');
            
            // Update dashboard stats and employee selects
            updateDashboardStats();
            populateEmployeeSelects();
            populateMandalSelects();
        }
        
        // Show employee list
        function showEmployeeList() {
            const listContainer = document.getElementById('employeeList');
            
            if (employees.length === 0) {
                listContainer.innerHTML = '<p class="text-center text-muted">No employees found</p>';
            } else {
                listContainer.innerHTML = employees.map(emp => `
                    <div class="employee-item">
                        <div class="employee-info" onclick="loadEmployee(${JSON.stringify(emp).replace(/"/g, '&quot;')})">
                            <strong>${emp.gpfAccountNo}</strong> - ${emp.name}<br>
                            <small>${emp.designation} | ${emp.mandal} | ${emp.placeOfWork} | ${emp.financialYear}</small>
                        </div>
                        <div class="employee-actions">
                            <button class="btn-icon delete" onclick="event.stopPropagation(); deleteEmployee(${emp.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            const modal = new bootstrap.Modal(document.getElementById('employeeListModal'));
            modal.show();
        }
        
        // Show search employee modal
        function showSearchEmployeeModal() {
            document.getElementById('searchGpfAccountNo').value = '';
            document.getElementById('searchResult').innerHTML = '';
            searchedEmployee = null;
            
            const modal = new bootstrap.Modal(document.getElementById('searchEmployeeModal'));
            modal.show();
        }
        
        // Search employee by GPF Account No - Updated to include GPF table
        function searchEmployeeByGpf() {
            const gpfAccountNo = document.getElementById('searchGpfAccountNo').value.trim();
            
            if (!gpfAccountNo) {
                showNotification('Please enter a GPF Account No', 'error');
                return;
            }
            
            const employee = employees.find(e => e.gpfAccountNo === gpfAccountNo);
            
            if (!employee) {
                document.getElementById('searchResult').innerHTML = `
                    <div class="alert alert-warning">
                        No employee found with GPF Account No: ${gpfAccountNo}
                    </div>
                `;
                searchedEmployee = null;
                return;
            }
            
            searchedEmployee = employee;
            
            // Calculate summary values
            const summary = calculateSummary(employee);
            
            // Display employee details and summary with print button
            document.getElementById('searchResult').innerHTML = `
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">Employee Details</h6>
                        <button class="btn btn-sm btn-light" onclick="printSearchEmployee()">
                            <i class="bi bi-printer"></i> Print
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>GPF Account No:</strong> ${employee.gpfAccountNo}</p>
                                <p><strong>Employee Name:</strong> ${employee.name}</p>
                                <p><strong>Designation:</strong> ${employee.designation}</p>
                                <p><strong>Mandal:</strong> ${employee.mandal}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Place Of Work:</strong> ${employee.placeOfWork}</p>
                                <p><strong>Financial Year:</strong> ${employee.financialYear}</p>
                                <p><strong>Opening Balance:</strong> ${employee.openingBalance.toLocaleString('en-IN')}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GPF Transactions Table -->
                <div class="card mt-3">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">Monthly GPF Transactions</h6>
                    </div>
                    <div class="card-body p-0">
                        ${employee.transactions.length > 0 ? `
                            <table class="gpf-table">
                                <thead>
                                            <tr>
                                                <th style="width: 15%">MONTH</th>
                                                <th style="width: 16%">OB</th>
                                                <th style="width: 16%">SUBSCRIPTION</th>
                                                <th style="width: 16%">DA + PF RECOVERY</th>
                                                <th style="width: 16%">WITHDRAWAL</th>
                                                <th style="width: 21%">CB</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${employee.transactions.map((trans, index) => `
                                                <tr>
                                                            <td class="month-cell">${trans.month}</td>
                                                            <td>${trans.ob.toLocaleString('en-IN')}</td>
                                                            <td>${trans.subscription.toLocaleString('en-IN')}</td>
                                                            <td>${trans.recovery.toLocaleString('en-IN')}</td>
                                                            <td>${trans.loan.toLocaleString('en-IN')}</td>
                                                            <td>${trans.cb.toLocaleString('en-IN')}</td>
                                                        </tr>
                                            `).join('')}
                                            <tr class="total-row">
                                                <td class="month-cell">TOTAL</td>
                                                <td>-</td>
                                                <td>${employee.transactions.reduce((sum, trans) => sum + trans.subscription, 0).toLocaleString('en-IN')}</td>
                                                <td>${employee.transactions.reduce((sum, trans) => sum + trans.recovery, 0).toLocaleString('en-IN')}</td>
                                                <td>${employee.transactions.reduce((sum, trans) => sum + trans.loan, 0).toLocaleString('en-IN')}</td>
                                                <td>${employee.transactions.reduce((sum, trans) => sum + trans.cb, 0).toLocaleString('en-IN')}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                        ` : `
                            <div class="empty-state">
                                <i class="bi bi-inbox"></i>
                                <p>No transactions recorded for this employee</p>
                            </div>
                        `}
                    </div>
                </div>
                
                    <h6 class="mt-3 mb-2">Annual Summary</h6>
                    <table class="table table-sm table-bordered">
                        <tr>
                            <td>Opening Balance</td>
                            <td class="text-end">${summary.totalOB.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Total Subscription</td>
                            <td class="text-end">${summary.totalSubscription.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Total DA + PF Recovery</td>
                            <td class="text-end">${summary.totalDA.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Total Withdrawal</td>
                            <td class="text-end">${summary.totalLoan.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Cumulative (Sum of all CB)</td>
                            <td class="text-end">${summary.cumulative.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Interest (7.1% p.a.)</td>
                            <td class="text-end">${summary.interest.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Gross (OB + Subscription + Interest)</td>
                            <td class="text-end">${summary.gross.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr class="table-primary">
                            <td>Closing Balance</td>
                            <td class="text-end">${summary.closingBalance.toLocaleString('en-IN')}</td>
                        </tr>
                        </table>
                    </div>
                </div>
                
                
            `;
        }
        
        // Print search employee results - FIXED VERSION with GPF table
        function printSearchEmployee() {
            if (!searchedEmployee) {
                showNotification('Please search for an employee first', 'error');
                return;
            }
            
            // Create a comprehensive print stylesheet
            const printStyles = document.createElement('style');
            printStyles.innerHTML = `
                @media print {
                    body {
                        font-family: Arial, sans-serif;
                        margin: 10mm;
                        font-size: 6px;
                    }
                    
                    /* Hide all elements except what we want to print */
                    body > *:not(.print-container):not(.print-container *) {
                        display: none !important;
                    }
                    
                    /* Create print container */
                    .print-container {
                        display: block !important;
                        position: relative !important;
                        width: 100% !important;
                        height: auto !important;
                        overflow: visible !important;
                        background: white !important;
                        color: black !important;
                    }
                    
                    /* Print header styles */
                    .print-header {
                        display: block !important;
                        visibility: visible !important;
                        text-align: center !important;
                        margin-bottom: 10px !important;
                        padding: 15px !important;
                        border-bottom: 2px solid #4a7ca7 !important;
                        page-break-after: avoid !important;
                    }
                    
                    .print-header h1 {
                        font-size: 7px !important;
                        font-weight: bold !important;
                        margin-bottom: 5px !important;
                        color: #4a7ca7 !important;
                    }
                    
                    .print-header h2 {
                        font-size: 5px !important;
                        margin-bottom: 0 !important;
                        color: #6c9bd2 !important;
                    }
                    
                    /* Print navbar */
                    .print-navbar {
                        display: flex !important;
                        background: linear-gradient(to right, #4a7ca7, #6c9bd2) !important;
                        color: white !important;
                        padding: 10px !important;
                        margin-bottom: 10px !important;
                        align-items: center !important;
                        page-break-after: avoid !important;
                    }
                    
                    .print-navbar-brand {
                        display: flex !important;
                        align-items: center !important;
                        color: white !important;
                        font-weight: bold !important;
                    }
                    
                    .print-navbar img {
                        height: 40px !important;
                        margin-right: 10px !important;
                        border-radius: 50% !important;
                    }
                    
                    /* Employee details */
                    .print-details {
                        margin-bottom: 20px !important;
                        padding: 15px !important;
                        background-color: #f5f8fc !important;
                        border: 1px solid #ddd !important;
                    }
                    
                    .print-detail-row {
                        display: flex !important;
                        margin-bottom: 8px !important;
                        font-size: 9px !important;
                    }
                    
                    .print-detail-label {
                        font-weight: bold !important;
                        width: 180px !important;
                    }
                    
                    .print-detail-value {
                        flex: 1 !important;
                    }
                    
                    /* GPF Transactions table - NEW STYLES */
                    .print-gpf-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        margin-bottom: 6px !important;
                        font-size: 10px !important;
                    }
                    
                    .print-gpf-table th {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        border: 1px solid #ddd !important;
                        padding: 8px !important;
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .print-gpf-table td {
                        border: 1px solid #ddd !important;
                        padding: 8px !important;
                    }
                    
                    .print-gpf-table td:first-child {
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .print-gpf-table td:nth-child(n+2) {
                        text-align: right !important;
                    }
                    
                    .print-gpf-table .total-row {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    /* Summary table */
                    .print-summary {
                        margin-top: 4px !important;
                    }
                    
                    .print-summary-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        font-size: 10px !important;
                    }
                    
                    .print-summary-table th {
                        background-color: #4a7ca7 !important;
                        color: white !important;
                        border: 1px solid #ddd !important;
                        padding: 8px !important;
                        text-align: left !important;
                        font-weight: bold !important;
                    }
                    
                    .print-summary-table td {
                        border: 1px solid #ddd !important;
                        padding: 8px !important;
                    }
                    
                    .print-summary-table td:first-child {
                        font-weight: bold !important;
                        width: 60% !important;
                    }
                    
                    .print-summary-table td:last-child {
                        text-align: right !important;
                    }
                    
                    .print-highlight {
                        background-color: #f5f8fc !important;
                        font-weight: bold !important;
                    }
                    
                    /* Print footer */
                    .print-footer {
                        position: fixed !important;
                        bottom: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        text-align: center !important;
                        padding: 10px !important;
                        font-size: 9px !important;
                        color: #666 !important;
                        border-top: 1px solid #ddd !important;
                    }
                    
                    /* Override all other styles */
                    body {
                        font-family: Arial, sans-serif !important;
                        margin: 0 !important;
                        padding: 0 !important;
                        background: white !important;
                        color: black !important;
                        font-size: 6px !important;
                    }
                }
            `;
            
            // Get the summary
            const summary = calculateSummary(searchedEmployee);
            
            // Create print container with all content
            const printContainer = document.createElement('div');
            printContainer.className = 'print-container';
            printContainer.innerHTML = `
                <div class="print-navbar">
                    <div class="print-navbar-brand">
                        <img src="https://ik.imagekit.io/htkonwcyl/pics/Nlr-zp.jpeg?updatedAt=1765869301452" alt="GPF Logo">H-SECTION<br> ZP NELLORE<br>zppnlrhsec@gmail.com
                        <h1 class="custome">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            DEPUTY CHEIF EXECUTIVE OFFICER,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ZP, NELLORE </h1>

                            
                      
                    </div>
                </div>
                
                <div class="header-section no-print">
                <img src="https://ik.imagekit.io/htkonwcyl/pics/Emblem_of_Andhra_Pradesh_before_2014.svg.png?updatedAt=1765727491775" alt="GPF Logo" class="logo">
                <h1 class=s2>ZP PROVIDENT FUND</h1>
                <h2 class=s3>ANDHRA PRADESH, SPSR NELLORE DISTRICT</h2>
            </div>
                
                <div class="print-details , h2">
                    <h6 class="size">Employee Details</h6>
                    <div class="print-detail-row">
                        <span class="print-detail-label">GPF Account No:</span>
                        <span class="print-detail-value">${searchedEmployee.gpfAccountNo}</span>
                    </div>
                    <div class="print-detail-row">
                        <span class="print-detail-label">Employee Name:</span>
                        <span class="print-detail-value">${searchedEmployee.name}</span>
                    </div>
                    <div class="print-detail-row">
                        <span class="print-detail-label">Designation:</span>
                        <span class="print-detail-value">${searchedEmployee.designation}</span>
                    </div>
                    <div class="print-detail-row">
                        <span class="print-detail-label">Mandal:</span>
                        <span class="print-detail-value">${searchedEmployee.mandal}</span>
                    </div>
                    <div class="print-detail-row">
                        <span class="print-detail-label">Place Of Work:</span>
                        <span class="print-detail-value">${searchedEmployee.placeOfWork}</span>
                    </div>
                    <div class="print-detail-row">
                        <span class="print-detail-label">Financial Year:</span>
                        <span class="print-detail-value">${searchedEmployee.financialYear}</span>
                    </div>
                    <div class="print-detail-row">
                        <span class="print-detail-label">Opening Balance:</span>
                        <span class="print-detail-value">${searchedEmployee.openingBalance.toLocaleString('en-IN')}</span>
                    </div>
                </div>
                
                <!-- GPF Transactions Table - NEW SECTION -->
                <div class="print-gpf-section ">
                    <h6 class="size">Monthly GPF Transactions</h6>
                    ${searchedEmployee.transactions.length > 0 ? `
                        <table class="print-gpf-table , h1">
                            <thead>
                                <tr>
                                    <th style="width: 15%">MONTH</th>
                                    <th style="width: 16%">OB</th>
                                    <th style="width: 16%">SUBSCRIPTION</th>
                                    <th style="width: 16%">DA + PF RECOVERY</th>
                                    <th style="width: 16%">WITHDRAWAL</th>
                                    <th style="width: 21%">CB</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${searchedEmployee.transactions.map((trans, index) => `
                                    <tr>
                                        <td class="month-cell">${trans.month}</td>
                                        <td>${trans.ob.toLocaleString('en-IN')}</td>
                                        <td>${trans.subscription.toLocaleString('en-IN')}</td>
                                        <td>${trans.recovery.toLocaleString('en-IN')}</td>
                                        <td>${trans.loan.toLocaleString('en-IN')}</td>
                                        <td>${trans.cb.toLocaleString('en-IN')}</td>
                                    </tr>
                                `).join('')}
                                <tr class="total-row">
                                    <td class="month-cell">TOTAL</td>
                                    <td>-</td>
                                    <td>${searchedEmployee.transactions.reduce((sum, trans) => sum + trans.subscription, 0).toLocaleString('en-IN')}</td>
                                    <td>${searchedEmployee.transactions.reduce((sum, trans) => sum + trans.recovery, 0).toLocaleString('en-IN')}</td>
                                    <td>${searchedEmployee.transactions.reduce((sum, trans) => sum + trans.loan, 0).toLocaleString('en-IN')}</td>
                                    <td>${searchedEmployee.transactions.reduce((sum, trans) => sum + trans.cb, 0).toLocaleString('en-IN')}</td>
                                </tr>
                            </tbody>
                        </table>
                    ` : `
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <p>No transactions recorded for this employee</p>
                        </div>
                    `}
                </div>
                
                <div class="print-summary">
                    <h6 class="size">Annual Summary</h6>
                    <table class="print-summary-table">
                        <tr>
                            <td>Opening Balance</td>
                            <td>${summary.totalOB.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Total Subscription</td>
                            <td>${summary.totalSubscription.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Total DA + PF Recovery</td>
                            <td>${summary.totalDA.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Total Withdrawal</td>
                            <td>${summary.totalLoan.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Cumulative (Sum of all CB)</td>
                            <td>${summary.cumulative.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Interest (7.1% p.a.)</td>
                            <td>${summary.interest.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr>
                            <td>Gross (OB + Subscription + Interest)</td>
                            <td>${summary.gross.toLocaleString('en-IN')}</td>
                        </tr>
                        <tr class="print-highlight">
                            <td>Closing Balance</td>
                            <td>${summary.closingBalance.toLocaleString('en-IN')}</td>
                        </tr>
                    </table>
                </div>
                
                <div class="print-footer ">
                    <p class="small">Generated on: ${new Date().toLocaleDateString('en-IN', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })}</p>
                </div>
            `;
            
            // Hide all body content
            document.body.style.display = 'none';
            
            // Add print container to body
            document.body.appendChild(printContainer);
            document.body.style.display = 'block';
            
            // Add print styles to document
            document.head.appendChild(printStyles);
            
            // Trigger print dialog
            window.print();
            
            // Restore original state after printing
            setTimeout(() => {
                document.head.removeChild(printStyles);
                document.body.removeChild(printContainer);
                document.body.style.display = '';
            }, 1000);
        }
        
        // Delete employee
        function deleteEmployee(employeeId) {
            if (confirm('Are you sure you want to delete this employee record?')) {
                employees = employees.filter(e => e.id !== employeeId);
                localStorage.setItem('gpfEmployees', JSON.stringify(employees));
                
                // If we deleted the current employee, go back to selection
                if (currentEmployee && currentEmployee.id === employeeId) {
                    clearCurrentEmployee();
                }
                
                // Refresh the list if it's open
                showEmployeeList();
                showNotification('Employee record deleted successfully!', 'success');
                
                // Update dashboard stats and employee selects
                updateDashboardStats();
                populateEmployeeSelects();
                populateMandalSelects();
            }
        }
        
        // Delete current employee
        function deleteCurrentEmployee() {
            if (!currentEmployee) {
                showNotification('No employee selected', 'error');
                return;
            }
            
            if (confirm(`Are you sure you want to delete the record for ${currentEmployee.name}?`)) {
                employees = employees.filter(e => e.id !== currentEmployee.id);
                localStorage.setItem('gpfEmployees', JSON.stringify(employees));
                clearCurrentEmployee();
                showNotification('Employee record deleted successfully!', 'success');
                
                // Update dashboard stats and employee selects
                updateDashboardStats();
                populateEmployeeSelects();
                populateMandalSelects();
            }
        }
        
        // Load employee
        function loadEmployee(employee) {
            currentEmployee = employee;
            
            // Update employee details
            document.getElementById('gpfAccountNo').textContent = employee.gpfAccountNo;
            document.getElementById('employeeName').textContent = employee.name;
            document.getElementById('designation').textContent = employee.designation;
            document.getElementById('placeOfWork').textContent = employee.placeOfWork;
            document.getElementById('mandal').textContent = employee.mandal;
            document.getElementById('financialYear').textContent = employee.financialYear;
            
            // Show employee sections
            document.getElementById('employeeSelection').style.display = 'none';
            document.getElementById('employeeDetails').style.display = 'block';
            document.getElementById('tableSection').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'block';
            
            // Close modal if open
            const modal = bootstrap.Modal.getInstance(document.getElementById('employeeListModal'));
            if (modal) modal.hide();
            
            // Render transactions
            renderTransactions();
        }
        
        // Render employee details with edit mode support
        function renderEmployeeDetails() {
            const employeeDetails = document.getElementById('employeeDetails');
            
            if (isEditMode) {
                // Convert to editable fields
                employeeDetails.innerHTML = `
                    <div class="detail-row">
                        <span class="detail-label">GPF Account No:</span>
                        <input type="text" class="detail-input" id="editGpfAccountNo" value="${currentEmployee.gpfAccountNo}" readonly>
                        <span class="edit-indicator"><i class="bi bi-pencil-square"></i></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Employee Name:</span>
                        <input type="text" class="detail-input" id="editEmployeeName" value="${currentEmployee.name}">
                        <span class="edit-indicator"><i class="bi bi-pencil-square"></i></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Designation:</span>
                        <input type="text" class="detail-input" id="editDesignation" value="${currentEmployee.designation}">
                        <span class="edit-indicator"><i class="bi bi-pencil-square"></i></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Place Of Work:</span>
                        <input type="text" class="detail-input" id="editPlaceOfWork" value="${currentEmployee.placeOfWork}">
                        <span class="edit-indicator"><i class="bi bi-pencil-square"></i></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Mandal:</span>
                        <input type="text" class="detail-input" id="editMandal" value="${currentEmployee.mandal}">
                        <span class="edit-indicator"><i class="bi bi-pencil-square"></i></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Financial Year:</span>
                        <select class="detail-input" id="editFinancialYear">
                            <option value="2021-2022" ${currentEmployee.financialYear === '2021-2022' ? 'selected' : ''}>2021-2022</option>
                            <option value="2022-2023" ${currentEmployee.financialYear === '2022-2023' ? 'selected' : ''}>2022-2023</option>
                            <option value="2023-2024" ${currentEmployee.financialYear === '2023-2024' ? 'selected' : ''}>2023-2024</option>
                            <option value="2024-2025" ${currentEmployee.financialYear === '2024-2025' ? 'selected' : ''}>2024-2025</option>
                            <option value="2025-2026" ${currentEmployee.financialYear === '2025-2026' ? 'selected' : ''}>2025-2026</option>
                            <option value="2026-2027" ${currentEmployee.financialYear === '2026-2027' ? 'selected' : ''}>2026-2027</option>
                        </select>
                        <span class="edit-indicator"><i class="bi bi-pencil-square"></i></span>
                    </div>
                `;
                
                // Add edit indicator to show we're in edit mode
                employeeDetails.classList.add('edit-mode');
            } else {
                // Convert back to display mode
                employeeDetails.innerHTML = `
                    <div class="detail-row">
                        <span class="detail-label">GPF Account No:</span>
                        <span class="detail-value" id="gpfAccountNo">${currentEmployee.gpfAccountNo}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Employee Name:</span>
                        <span class="detail-value" id="employeeName">${currentEmployee.name}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Designation:</span>
                        <span class="detail-value" id="designation">${currentEmployee.designation}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Place Of Work:</span>
                        <span class="detail-value" id="placeOfWork">${currentEmployee.placeOfWork}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Mandal:</span>
                        <span class="detail-value" id="mandal">${currentEmployee.mandal}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Financial Year:</span>
                        <span class="detail-value" id="financialYear">${currentEmployee.financialYear}</span>
                    </div>
                `;
                
                // Remove edit indicator
                employeeDetails.classList.remove('edit-mode');
            }
        }
        
        // Render transactions
        function renderTransactions() {
            const tbody = document.getElementById('gpfTableBody');
            const emptyState = document.getElementById('emptyState');
            const summarySection = document.getElementById('summarySection');
            
            if (!currentEmployee || currentEmployee.transactions.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                summarySection.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            summarySection.style.display = 'block';
            tbody.innerHTML = '';
            
            let totalSubscription = 0;
            let totalRecovery = 0;
            let totalLoan = 0;
            let totalCB = 0;
            
            currentEmployee.transactions.forEach((trans, index) => {
                const tr = document.createElement('tr');
                tr.className = isEditMode ? 'edit-mode' : '';
                
                // Create HTML for row (without remarks column)
                let rowHtml = `
                    <td class="month-cell">${trans.month}</td>
                    <td>${isEditMode && index === 0 ? `<input type="text" value="${trans.ob}" data-field="ob" data-index="${index}" maxlength="8">` : trans.ob.toLocaleString('en-IN')}</td>
                    <td>${isEditMode ? `<input type="text" value="${trans.subscription}" data-field="subscription" data-index="${index}" maxlength="8">` : trans.subscription.toLocaleString('en-IN')}</td>
                    <td>${isEditMode ? `<input type="text" value="${trans.recovery}" data-field="recovery" data-index="${index}" maxlength="8">` : trans.recovery.toLocaleString('en-IN')}</td>
                    <td>${isEditMode ? `<input type="text" value="${trans.loan}" data-field="loan" data-index="${index}" maxlength="8">` : trans.loan.toLocaleString('en-IN')}</td>
                    <td>${trans.cb.toLocaleString('en-IN')}</td>
                `;
                
                tr.innerHTML = rowHtml;
                tbody.appendChild(tr);
                
                totalSubscription += trans.subscription;
                totalRecovery += trans.recovery;
                totalLoan += trans.loan;
                totalCB += trans.cb;
            });
            
            // Add total row (without remarks column)
            const totalTr = document.createElement('tr');
            totalTr.className = 'total-row';
            totalTr.innerHTML = `
                <td class="month-cell">TOTAL</td>
                <td>-</td>
                <td>${totalSubscription.toLocaleString('en-IN')}</td>
                <td>${totalRecovery.toLocaleString('en-IN')}</td>
                <td>${totalLoan.toLocaleString('en-IN')}</td>
                <td>${totalCB.toLocaleString('en-IN')}</td>
            `;
            tbody.appendChild(totalTr);
            
            // Update summary table
            updateSummaryTable();
            
            if (isEditMode) {
                // Add event listeners to inputs
                document.querySelectorAll('#gpfTableBody input').forEach(input => {
                    input.addEventListener('input', handleInputChange);
                    input.addEventListener('keydown', handleKeyDown);
                });
            }
        }
        
        // Update summary table
        function updateSummaryTable() {
            if (!currentEmployee) return;
            
            // Calculate summary values
            const summary = calculateSummary(currentEmployee);
            
            // Update summary table
            document.getElementById('totalOB').textContent = summary.totalOB.toLocaleString('en-IN');
            document.getElementById('totalSubscription').textContent = summary.totalSubscription.toLocaleString('en-IN');
            document.getElementById('totalDA').textContent = summary.totalDA.toLocaleString('en-IN');
            document.getElementById('totalLoan').textContent = summary.totalLoan.toLocaleString('en-IN');
            document.getElementById('cumulative').textContent = summary.cumulative.toLocaleString('en-IN');
            document.getElementById('interest').textContent = summary.interest.toLocaleString('en-IN');
            document.getElementById('gross').textContent = summary.gross.toLocaleString('en-IN');
            document.getElementById('closingBalance').textContent = summary.closingBalance.toLocaleString('en-IN');
        }
        
        // Handle input change with delay
        function handleInputChange() {
            // Clear any existing timeout
            clearTimeout(calculationTimeout);
            
            // Set a new timeout to calculate after a short delay
            calculationTimeout = setTimeout(() => {
                calculateCB();
            }, 500); // 500ms delay
        }
        
        // Handle keyboard navigation
        function handleKeyDown(e) {
            const input = e.target;
            const index = parseInt(input.dataset.index);
            const field = input.dataset.field;
            
            // Move to next field on Tab key
            if (e.key === 'Tab') {
                // Allow default tab behavior
                return;
            }
            
            // Move to next row on Enter key
            if (e.key === 'Enter') {
                e.preventDefault();
                const fields = ['ob', 'subscription', 'recovery', 'loan'];
                const currentFieldIndex = fields.indexOf(field);
                
                // If not the last field, move to the next field in the same row
                if (currentFieldIndex < fields.length - 1) {
                    const nextField = fields[currentFieldIndex + 1];
                    const nextInput = document.querySelector(`input[data-field="${nextField}"][data-index="${index}"]`);
                    if (nextInput) {
                        nextInput.focus();
                        nextInput.select();
                    }
                } 
                // If the last field, move to the first field of the next row
                else if (index < currentEmployee.transactions.length - 1) {
                    const nextRowInput = document.querySelector(`input[data-field="subscription"][data-index="${index + 1}"]`);
                    if (nextRowInput) {
                        nextRowInput.focus();
                        nextRowInput.select();
                    }
                }
            }
        }
        
        // Calculate CB (Closing Balance)
        function calculateCB() {
            if (!isEditMode) return;
            
            // Get all input values
            document.querySelectorAll('#gpfTableBody input').forEach(input => {
                const index = parseInt(input.dataset.index);
                const field = input.dataset.field;
                const value = parseInt(input.value) || 0;
                currentEmployee.transactions[index][field] = value;
            });
            
            // Calculate CB for each month
            currentEmployee.transactions.forEach((trans, index) => {
                // For the first month, OB is the opening balance (editable)
                if (index === 0) {
                    trans.cb = trans.ob + trans.subscription + trans.recovery - trans.loan;
                } else {
                    // For subsequent months, OB is the previous month's CB
                    trans.ob = currentEmployee.transactions[index - 1].cb;
                    trans.cb = trans.ob + trans.subscription + trans.recovery - trans.loan;
                }
            });
            
            // Update OB and CB columns without re-rendering the whole table
            const obCells = document.querySelectorAll('#gpfTableBody tr:not(.total-row) td:nth-child(2)');
            const cbCells = document.querySelectorAll('#gpfTableBody tr:not(.total-row) td:nth-child(6)');
            
            obCells.forEach((cell, index) => {
                if (index < currentEmployee.transactions.length) {
                    // Only update OB for rows that are not editable (index > 0)
                    if (index > 0) {
                        cell.textContent = currentEmployee.transactions[index].ob.toLocaleString('en-IN');
                    }
                }
            });
            
            cbCells.forEach((cell, index) => {
                if (index < currentEmployee.transactions.length) {
                    cell.textContent = currentEmployee.transactions[index].cb.toLocaleString('en-IN');
                }
            });
            
            // Update total row
            updateTotalRow();
            
            // Update summary table
            updateSummaryTable();
        }
        
        // Update total row
        function updateTotalRow() {
            let totalSubscription = 0;
            let totalRecovery = 0;
            let totalLoan = 0;
            let totalCB = 0;
            
            currentEmployee.transactions.forEach(trans => {
                totalSubscription += trans.subscription;
                totalRecovery += trans.recovery;
                totalLoan += trans.loan;
                totalCB += trans.cb;
            });
            
            // Update total row values (without remarks column)
            const totalCells = document.querySelectorAll('#gpfTableBody .total-row td');
            if (totalCells.length >= 6) {
                totalCells[2].textContent = totalSubscription.toLocaleString('en-IN'); // Subscription total
                totalCells[3].textContent = totalRecovery.toLocaleString('en-IN');    // Recovery total
                totalCells[4].textContent = totalLoan.toLocaleString('en-IN');        // Loan total
                totalCells[5].textContent = totalCB.toLocaleString('en-IN');          // CB total
            }
        }
        
        // Update record - MODIFIED to include employee details
        function updateRecord() {
            if (!currentEmployee) {
                showNotification('Please select an employee first', 'error');
                return;
            }
            
            if (!isEditMode) {
                // Enter edit mode
                isEditMode = true;
                
                // Render employee details as editable
                renderEmployeeDetails();
                
                // If no transactions, create a monthly template
                if (currentEmployee.transactions.length === 0) {
                    const months = ['April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December', 'January', 'February', 'March'];
                    let runningCB = currentEmployee.openingBalance;
                    
                    currentEmployee.transactions = months.map((month, index) => {
                        const ob = index === 0 ? currentEmployee.openingBalance : runningCB;
                        const subscription = 0;
                        const recovery = 0;
                        const loan = 0;
                        
                        runningCB = ob + subscription + recovery - loan;
                        
                        return {
                            month,
                            ob,
                            subscription,
                            recovery,
                            loan,
                            cb: runningCB
                        };
                    });
                }
                
                renderTransactions();
                
                // Hide print button in edit mode
                document.querySelectorAll('.no-print-when-edit').forEach(el => {
                    el.style.display = 'none';
                });
                
                showNotification('Edit mode enabled. Update employee details and values, then click UPDATE RECORD again to save.', 'info');
            } else {
                // Save changes - Save both employee details and transactions
                isEditMode = false;
                
                // Save employee details from form
                currentEmployee.gpfAccountNo = document.getElementById('editGpfAccountNo').value;
                currentEmployee.name = document.getElementById('editEmployeeName').value;
                currentEmployee.designation = document.getElementById('editDesignation').value;
                currentEmployee.placeOfWork = document.getElementById('editPlaceOfWork').value;
                currentEmployee.mandal = document.getElementById('editMandal').value;
                currentEmployee.financialYear = document.getElementById('editFinancialYear').value;
                
                // Final calculation before saving
                calculateCB();
                
                // Render employee details back to display mode
                renderEmployeeDetails();
                renderTransactions();
                
                // Update in storage
                const empIndex = employees.findIndex(e => e.id === currentEmployee.id);
                if (empIndex !== -1) {
                    employees[empIndex] = currentEmployee;
                    localStorage.setItem('gpfEmployees', JSON.stringify(employees));
                }
                
                // Show print button after exiting edit mode
                document.querySelectorAll('.no-print-when-edit').forEach(el => {
                    el.style.display = 'inline-block';
                });
                
                showNotification('Employee details and transactions updated successfully!', 'success');
                
                // Update dashboard stats and employee selects
                updateDashboardStats();
                populateEmployeeSelects();
                populateMandalSelects();
            }
        }
        
        // Save record (new function)
        function saveRecord() {
            if (!currentEmployee) {
                showNotification('Please select an employee first', 'error');
                return;
            }
            
            if (!isEditMode) {
                showNotification('Please enter edit mode first by clicking UPDATE RECORD', 'error');
                return;
            }
            
            // Save employee details from form
            currentEmployee.gpfAccountNo = document.getElementById('editGpfAccountNo').value;
            currentEmployee.name = document.getElementById('editEmployeeName').value;
            currentEmployee.designation = document.getElementById('editDesignation').value;
            currentEmployee.placeOfWork = document.getElementById('editPlaceOfWork').value;
            currentEmployee.mandal = document.getElementById('editMandal').value;
            currentEmployee.financialYear = document.getElementById('editFinancialYear').value;
            
            // Save the current state without exiting edit mode
            calculateCB();
            
            // Update in storage
            const empIndex = employees.findIndex(e => e.id === currentEmployee.id);
            if (empIndex !== -1) {
                employees[empIndex] = currentEmployee;
                localStorage.setItem('gpfEmployees', JSON.stringify(employees));
            }
            
            showNotification('Employee details and transactions saved successfully! You can continue editing.', 'success');
            
            // Update dashboard stats and employee selects
            updateDashboardStats();
            populateEmployeeSelects();
            populateMandalSelects();
        }
        
        // Export to Excel - UPDATED VERSION
        function exportToExcel() {
            if (!currentEmployee) {
                showNotification('Please select an employee first', 'error');
                return;
            }
            
            // Prepare data for Excel
            const excelData = [];
            
            // Add header row
            excelData.push({
                'GPF Account No': 'GPF Account No',
                'Employee Name': 'Employee Name',
                'Designation': 'Designation',
                'Mandal': 'Mandal',
                'Place Of Work': 'Place Of Work',
                'Financial Year': 'Financial Year',
                'Month': 'Month',
                'OB': 'OB',
                'Subscription': 'Subscription',
                'DA + PF Recovery': 'DA + PF Recovery',
                'Withdrawal': 'Withdrawal',
                'CB': 'CB'
            });
            
            // Add employee details to every row for clarity
            if (currentEmployee.transactions.length > 0) {
                // Add transactions
                currentEmployee.transactions.forEach(trans => {
                    excelData.push({
                        'GPF Account No': currentEmployee.gpfAccountNo,
                        'Employee Name': currentEmployee.name,
                        'Designation': currentEmployee.designation,
                        'Mandal': currentEmployee.mandal,
                        'Place Of Work': currentEmployee.placeOfWork,
                        'Financial Year': currentEmployee.financialYear,
                        'Month': trans.month,
                        'OB': trans.ob,
                        'Subscription': trans.subscription,
                        'DA + PF Recovery': trans.recovery,
                        'Withdrawal': trans.loan,
                        'CB': trans.cb
                    });
                });
                
                // Add summary
                const summary = calculateSummary(currentEmployee);
                excelData.push({
                    'GPF Account No': currentEmployee.gpfAccountNo,
                    'Employee Name': currentEmployee.name,
                    'Designation': currentEmployee.designation,
                    'Mandal': currentEmployee.mandal,
                    'Place Of Work': currentEmployee.placeOfWork,
                    'Financial Year': currentEmployee.financialYear,
                    'Month': 'SUMMARY',
                    'OB': summary.totalOB,
                    'Subscription': summary.totalSubscription,
                    'DA + PF Recovery': summary.totalDA,
                    'Withdrawal': summary.totalLoan,
                    'Interest (7.1% p.a.)': summary.interest,
                    'Gross (OB + Subscription + Interest)': summary.gross,
                    'Closing Balance': summary.closingBalance
                });
                
                // Create workbook
                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'GPF Records');
                
                // Generate filename with date
                const date = new Date().toISOString().split('T')[0];
                const filename = `ZPGPF_${currentEmployee.gpfAccountNo}_${currentEmployee.name}_${date}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
                showNotification('Data exported to Excel successfully!', 'success');
            }
        }
        
        // Export all employees to Excel - FINAL VERSION WITH HEADINGS IN FIRST ROW ONLY
        function exportAllEmployeesToExcel() {
            if (employees.length === 0) {
                showNotification('No data to export', 'error');
                return;
            }
            
            // Prepare data for Excel
            const excelData = [];
            
            // Add header row only once
            excelData.push([
                'GPF Account No',
                'Employee Name',
                'Designation',
                'Mandal',
                'Place Of Work',
                'Financial Year',
                'Opening Balance'
            ]);
            
            // Get all unique months from all employees
            const allMonths = new Set();
            employees.forEach(emp => {
                emp.transactions.forEach(trans => {
                    allMonths.add(trans.month);
                });
            });
            const months = Array.from(allMonths).sort();
            
            // Add month headers for subscription
            months.forEach(month => {
                excelData[0].push(`Sub_${month}`);
            });
            
            // Add total subscription header
            excelData[0].push('Total Subscription');
            
            // Add month headers for DA + PF Recovery
            months.forEach(month => {
                excelData[0].push(`DA_${month}`);
            });
            
            // Add total DA + PF Recovery header
            excelData[0].push('Total DA + PF Recovery');
            
            // Add month headers for Loan/Withdrawal
            months.forEach(month => {
                excelData[0].push(`Loan_${month}`);
            });
            
            // Add total Loan header
            excelData[0].push('Total Withdrawal');
            
            // Add summary headers
            excelData[0].push(
                'Interest (7.1% p.a.)',
                'Gross (OB + Sub + Int)',
                'Closing Balance'
            );
            
            // Add employee data rows
            employees.forEach(emp => {
                const employeeRow = [
                    emp.gpfAccountNo,
                    emp.name,
                    emp.designation,
                    emp.mandal,
                    emp.placeOfWork,
                    emp.financialYear,
                    emp.openingBalance
                ];
                
                // Add subscription data for each month
                months.forEach(month => {
                    const trans = emp.transactions.find(t => t.month === month);
                    employeeRow.push(trans ? trans.subscription : 0);
                });
                
                // Add total subscription
                const totalSubscription = emp.transactions.reduce((sum, trans) => sum + trans.subscription, 0);
                employeeRow.push(totalSubscription);
                
                // Add DA + PF Recovery data for each month
                months.forEach(month => {
                    const trans = emp.transactions.find(t => t.month === month);
                    employeeRow.push(trans ? trans.recovery : 0);
                });
                
                // Add total DA + PF Recovery
                const totalDA = emp.transactions.reduce((sum, trans) => sum + trans.recovery, 0);
                employeeRow.push(totalDA);
                
                // Add Loan data for each month
                months.forEach(month => {
                    const trans = emp.transactions.find(t => t.month === month);
                    employeeRow.push(trans ? trans.loan : 0);
                });
                
                // Add total Loan
                const totalLoan = emp.transactions.reduce((sum, trans) => sum + trans.loan, 0);
                employeeRow.push(totalLoan);
                
                // Calculate and add summary values
                const summary = calculateSummary(emp);
                employeeRow.push(
                    summary.interest,
                    summary.gross,
                    summary.closingBalance
                );
                
                // Add complete row to data
                excelData.push(employeeRow);
            });
            
            // Create workbook
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'All ZPGPF Records');
            
            // Set column widths
            const colWidths = [
                { wch: 15 }, // GPF Account No
                { wch: 25 }, // Employee Name
                { wch: 20 }, // Designation
                { wch: 15 }, // Mandal
                { wch: 20 }, // Place Of Work
                { wch: 15 }, // Financial Year
                { wch: 15 }  // Opening Balance
            ];
            
            // Add width for each month column (3 sets of months)
            months.forEach(() => {
                colWidths.push({ wch: 10 }); // Sub_month
            });
            colWidths.push({ wch: 18 }); // Total Subscription
            
            months.forEach(() => {
                colWidths.push({ wch: 10 }); // DA_month
            });
            colWidths.push({ wch: 18 }); // Total DA + PF Recovery
            
            months.forEach(() => {
                colWidths.push({ wch: 10 }); // Loan_month
            });
            colWidths.push({ wch: 18 }); // Total Withdrawal
            
            colWidths.push(
                { wch: 18 }, // Interest
                { wch: 25 }, // Gross
                { wch: 18 }  // Closing Balance
            );
            
            ws['!cols'] = colWidths;
            
            // Apply styling to header row
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const cellRef = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[cellRef]) continue;
                
                if (!ws[cellRef].s) ws[cellRef].s = {};
                ws[cellRef].s.font = { bold: true };
                ws[cellRef].s.fill = { fgColor: { rgb: "D4E4F7" } };
            }
            
            // Generate filename with date
            const date = new Date().toISOString().split('T')[0];
            const filename = `All_ZPGPF_Records_${date}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, filename);
            showNotification('All employees data exported to Excel successfully!', 'success');
        }
        
        // Delete all records function
        function deleteAllRecords() {
            if (confirm('Are you sure you want to delete all records? This action cannot be undone!')) {
                employees = [];
                localStorage.setItem('gpfEmployees', JSON.stringify(employees));
                
                // Update dashboard stats and employee selects
                updateDashboardStats();
                populateEmployeeSelects();
                populateMandalSelects();
                
                showNotification('All records deleted successfully!', 'success');
            }
        }
        
        // Delete single record function
        function deleteSingleEmployee() {
            const gpfAccountNo = document.getElementById('deleteGpfAccountNo').value.trim();
            
            if (!gpfAccountNo) {
                showNotification('Please enter a GPF Account No', 'error');
                return;
            }
            
            const employee = employees.find(e => e.gpfAccountNo === gpfAccountNo);
            
            if (!employee) {
                showNotification('No employee found with GPF Account No: ' + gpfAccountNo, 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this employee record?')) {
                employees = employees.filter(e => e.gpfAccountNo !== gpfAccountNo);
                localStorage.setItem('gpfEmployees', JSON.stringify(employees));
                
                // Refresh the list if it's open
                const listContainer = document.getElementById('employeeList');
                if (listContainer) {
                    const currentItems = listContainer.querySelectorAll('.employee-item');
                    currentItems.forEach(item => {
                        const empData = JSON.parse(item.getAttribute('data-emp').replace(/&quot;/g, '"'));
                        if (empData.gpfAccountNo === gpfAccountNo) {
                            item.remove();
                        }
                    });
                }
                
                showNotification('Employee record deleted successfully!', 'success');
                
                // Update dashboard stats and employee selects
                updateDashboardStats();
                populateEmployeeSelects();
                populateMandalSelects();
            }
        }
        
        // Calculate summary values
        function calculateSummary(employee) {
            let totalSubscription = 0;
            let totalDA = 0;
            let totalLoan = 0;
            let cumulative = 0;
            
            if (employee.transactions.length > 0) {
                // Sum up all transactions
                employee.transactions.forEach(trans => {
                    totalSubscription += trans.subscription;
                    totalDA += trans.recovery;
                    totalLoan += trans.loan;
                    cumulative += trans.cb; // Sum all CB values for cumulative
                });
            } else {
                // If no transactions, use opening balance
                cumulative = employee.openingBalance;
            }
            
            // Calculate interest (7.1% per annum)
            const interest = Math.round(cumulative / 12 * 7.1 / 100);
            
            // Calculate gross (OB + Subscription + Interest)
            const gross = employee.openingBalance + totalSubscription + interest;
            
            // Calculate closing balance (OB + Subscription + Interest - Loan)
            const closingBalance = employee.openingBalance + totalSubscription + interest - totalLoan;
            
            return {
                totalOB: employee.openingBalance,
                totalSubscription,
                totalDA,
                totalLoan,
                cumulative,
                interest,
                gross,
                closingBalance
            };
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = type === 'success' ? '#5cb85c' : type === 'error' ? '#d9534f' : '#5bc0de';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Clear current employee
        function clearCurrentEmployee() {
            currentEmployee = null;
            isEditMode = false;
            
            document.getElementById('employeeSelection').style.display = 'block';
            document.getElementById('employeeDetails').style.display = 'none';
            document.getElementById('tableSection').style.display = 'none';
            document.getElementById('actionButtons').style.display = 'none';
        }
        
        // Exit application
        function exitApplication() {
            if (confirm('Are you sure you want to exit the application?')) {
                window.location.href = 'about:blank';
            }
        }
        
        // Prevent accidental page refresh during edit
        window.addEventListener('beforeunload', function(e) {
            if (isEditMode) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
